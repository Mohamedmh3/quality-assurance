import type { UseCase } from '../types';

export const orderRatingUseCases: UseCase[] = [
  {
    id: 'UC-ORDER-RATING-001',
    title: 'Initialize Order Rating Screen',
    priority: 'Critical',
    userType: 'End User',
    description: 'When a customer completes an order, they can rate both the restaurant and driver. The app loads rating options from the server based on the order type (restaurant or market).',
    preconditions: [
      'Customer has completed an order',
      'Order is in a rateable state',
      'Customer is logged in',
    ],
    steps: [
      {
        step: 1,
        action: 'App receives order rating navigation parameters (restaurant name, image URL, order ID, isMarket flag)',
        expectedResult: 'Navigation parameters are stored in state',
        uiState: 'Loading indicator shows while fetching rating options',
        flutterFile: 'order_rating_viewmodel.dart:136-159',
      },
      {
        step: 2,
        action: 'App calls fetchOrderRating API with orderId and isMarket flag',
        expectedResult: 'Rating options are fetched from server',
        uiState: 'Loading state changes to loaded',
        flutterFile: 'order_rating_viewmodel.dart:41-69',
      },
      {
        step: 3,
        action: 'App initializes ImagePickerViewModel with max photo upload limit from rating model',
        expectedResult: 'Image upload limit is set',
        uiState: 'Rating screen displays with restaurant rating section',
        flutterFile: 'order_rating_viewmodel.dart:149-159',
      },
    ],
    postconditions: [
      'Rating screen is displayed',
      'Restaurant rating section is shown',
      'Rating options are loaded and ready for selection',
    ],
    successCriteria: [
      'Rating screen loads without errors',
      'Restaurant information is displayed',
      'Star rating widget is visible',
      'Rating options are available',
    ],
    relatedTestCases: ['TC-ORDER-RATING-001', 'TC-ORDER-RATING-002'],
  },
  {
    id: 'UC-ORDER-RATING-002',
    title: 'Select Star Rating',
    priority: 'Critical',
    userType: 'End User',
    description: 'Customer taps on stars (1-5) to rate the restaurant or driver. The star selection determines which rating type (bad, neutral, good) and options are shown.',
    preconditions: [
      'Rating screen is loaded',
      'Rating options are available',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer taps on a star rating (1-5 stars)',
        expectedResult: 'Star value is stored in state',
        uiState: 'Selected stars are highlighted',
        flutterFile: 'order_rating_viewmodel.dart:496-557',
      },
      {
        step: 2,
        action: 'App determines rating type based on star value: 1-2 = bad, 3 = neutral, 4-5 = good',
        expectedResult: 'Appropriate rating type is selected',
        uiState: 'Rating type title is displayed',
        flutterFile: 'order_rating_viewmodel.dart:514-521',
      },
      {
        step: 3,
        action: 'App shows rating options for the selected type',
        expectedResult: 'Options list is displayed',
        uiState: 'Options list appears below star rating',
        flutterFile: 'order_rating_viewmodel.dart:463-494',
      },
    ],
    postconditions: [
      'Star rating is selected',
      'Rating type is determined',
      'Options for that type are displayed',
    ],
    successCriteria: [
      'Star selection is visually indicated',
      'Correct rating type is shown',
      'Appropriate options are displayed',
    ],
    relatedTestCases: ['TC-ORDER-RATING-003', 'TC-ORDER-RATING-004'],
  },
  {
    id: 'UC-ORDER-RATING-003',
    title: 'Select Rating Options',
    priority: 'High',
    userType: 'End User',
    description: 'Customer selects one or more rating options (reasons) for their rating. Some options may require sub-options or dish selection.',
    preconditions: [
      'Star rating is selected',
      'Rating type is determined',
      'Options are displayed',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer taps on a rating option',
        expectedResult: 'Option is added to selected options list',
        uiState: 'Option is visually selected (highlighted)',
        flutterFile: 'order_rating_viewmodel.dart:238-296',
      },
      {
        step: 2,
        action: 'If option has sub-options, customer can select a sub-option',
        expectedResult: 'Sub-option is added to the option',
        uiState: 'Sub-option is selected',
        flutterFile: 'order_rating_viewmodel.dart:298-344',
      },
      {
        step: 3,
        action: 'If sub-option requires dish selection, customer selects dishes',
        expectedResult: 'Dish IDs are added to sub-option',
        uiState: 'Selected dishes are indicated',
        flutterFile: 'order_rating_viewmodel.dart:346-390',
      },
      {
        step: 4,
        action: 'App validates if selection is required',
        expectedResult: 'Validation state is updated',
        uiState: 'Validation error is shown if required selection is missing',
        flutterFile: 'order_rating_viewmodel.dart:72-114',
      },
    ],
    postconditions: [
      'Options are selected',
      'Sub-options are selected if applicable',
      'Dishes are selected if applicable',
      'Validation is checked',
    ],
    successCriteria: [
      'Selected options are visually indicated',
      'Sub-options work correctly',
      'Dish selection works correctly',
      'Validation errors show when required',
    ],
    relatedTestCases: ['TC-ORDER-RATING-005', 'TC-ORDER-RATING-006', 'TC-ORDER-RATING-007'],
  },
  {
    id: 'UC-ORDER-RATING-004',
    title: 'Add Rating Notes',
    priority: 'Medium',
    userType: 'End User',
    description: 'Customer can add optional notes/comments to their rating. Notes are required if any selected option has noteRequired flag set to true.',
    preconditions: [
      'Rating options are selected',
      'At least one option may require notes',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer types in the notes text field',
        expectedResult: 'Note text is stored in state',
        uiState: 'Text appears in the notes field',
        flutterFile: 'order_rating_viewmodel.dart:162-187',
      },
      {
        step: 2,
        action: 'App checks if note is required based on selected options',
        expectedResult: 'Note requirement is determined',
        uiState: 'Validation error shows if note is required but empty',
        flutterFile: 'order_rating_viewmodel.dart:117-121',
      },
      {
        step: 3,
        action: 'Note is validated on form submission',
        expectedResult: 'Validation passes if note is provided when required',
        uiState: 'Error message shows if validation fails',
        flutterFile: 'rating_section_widget.dart:209-214',
      },
    ],
    postconditions: [
      'Note text is stored',
      'Note requirement is checked',
      'Validation state is updated',
    ],
    successCriteria: [
      'Notes can be entered',
      'Required notes show validation errors',
      'Optional notes work correctly',
    ],
    relatedTestCases: ['TC-ORDER-RATING-008'],
  },
  {
    id: 'UC-ORDER-RATING-005',
    title: 'Upload Rating Images',
    priority: 'Medium',
    userType: 'End User',
    description: 'Customer can upload images with their rating. Some options may require image upload. Maximum number of images is determined by the rating model.',
    preconditions: [
      'Rating screen is loaded',
      'ImagePickerViewModel is initialized',
      'Max photo limit is set',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer taps "Upload Image" button',
        expectedResult: 'Image picker opens',
        uiState: 'Image picker dialog appears',
        flutterFile: 'rating_section_widget.dart:138-166',
      },
      {
        step: 2,
        action: 'Customer selects images from gallery or camera',
        expectedResult: 'Images are added to ImagePickerViewModel',
        uiState: 'Selected images are displayed',
        flutterFile: 'rating_submit_button.dart:69-75',
      },
      {
        step: 3,
        action: 'App checks if image upload is required for selected options',
        expectedResult: 'Image requirement is determined',
        uiState: 'Validation error shows if image is required but not uploaded',
        flutterFile: 'rating_submit_button.dart:66-75',
      },
      {
        step: 4,
        action: 'Images are included in rating submission',
        expectedResult: 'Image paths are added to rating model',
        uiState: 'Images are uploaded with rating',
        flutterFile: 'order_rating_viewmodel.dart:192-198',
      },
    ],
    postconditions: [
      'Images are selected',
      'Images are stored',
      'Images are ready for upload',
    ],
    successCriteria: [
      'Image picker works correctly',
      'Images are displayed',
      'Image requirement validation works',
      'Images are uploaded successfully',
    ],
    relatedTestCases: ['TC-ORDER-RATING-009', 'TC-ORDER-RATING-010'],
  },
  {
    id: 'UC-ORDER-RATING-006',
    title: 'Submit Restaurant Rating',
    priority: 'Critical',
    userType: 'End User',
    description: 'Customer completes restaurant rating and proceeds to driver rating. If driver rating is not available, rating is submitted immediately.',
    preconditions: [
      'Restaurant rating is completed',
      'All required fields are filled',
      'Validation passes',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer taps "Next" or "Send" button',
        expectedResult: 'Form validation is triggered',
        uiState: 'Validation errors show if any',
        flutterFile: 'rating_submit_button.dart:85-96',
      },
      {
        step: 2,
        action: 'App validates rating data (star, options, notes, images)',
        expectedResult: 'Validation passes or fails',
        uiState: 'Validation errors are displayed',
        flutterFile: 'order_rating_viewmodel.dart:72-114',
      },
      {
        step: 3,
        action: 'If driver rating is available, app switches to driver rating tab',
        expectedResult: 'Driver rating screen is shown',
        uiState: 'Screen transitions to driver rating',
        flutterFile: 'order_rating_viewmodel.dart:559-563',
      },
      {
        step: 4,
        action: 'If driver rating is not available, rating is submitted immediately',
        expectedResult: 'Rating is sent to server',
        uiState: 'Loading indicator shows during submission',
        flutterFile: 'rating_submit_button.dart:104-111',
      },
    ],
    postconditions: [
      'Restaurant rating data is saved',
      'Driver rating screen is shown (if available)',
      'Or rating is submitted (if driver not available)',
    ],
    successCriteria: [
      'Validation works correctly',
      'Navigation to driver rating works',
      'Immediate submission works when driver not available',
    ],
    relatedTestCases: ['TC-ORDER-RATING-011', 'TC-ORDER-RATING-012'],
  },
  {
    id: 'UC-ORDER-RATING-007',
    title: 'Submit Driver Rating',
    priority: 'Critical',
    userType: 'End User',
    description: 'Customer completes driver rating and submits both restaurant and driver ratings together.',
    preconditions: [
      'Restaurant rating is completed',
      'Driver rating screen is shown',
      'Driver rating is completed',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer completes driver rating (star, options, notes)',
        expectedResult: 'Driver rating data is stored',
        uiState: 'Driver rating form is filled',
        flutterFile: 'order_rating_viewmodel.dart:559-563',
      },
      {
        step: 2,
        action: 'Customer taps "Send" button',
        expectedResult: 'Form validation is triggered',
        uiState: 'Validation errors show if any',
        flutterFile: 'rating_submit_button.dart:85-96',
      },
      {
        step: 3,
        action: 'App validates both restaurant and driver ratings',
        expectedResult: 'Validation passes',
        uiState: 'Loading indicator shows',
        flutterFile: 'order_rating_viewmodel.dart:203-224',
      },
      {
        step: 4,
        action: 'App submits rating to server via rateOrderV2 API',
        expectedResult: 'Rating is successfully submitted',
        uiState: 'Success dialog is shown',
        flutterFile: 'order_rating_viewmodel.dart:203-224',
      },
      {
        step: 5,
        action: 'If both ratings are 4+ stars, app rating prompt is shown',
        expectedResult: 'App rating dialog appears',
        uiState: 'App rating prompt is displayed',
        flutterFile: 'order_rating_screen.dart:63-73',
      },
    ],
    postconditions: [
      'Both ratings are submitted',
      'Success dialog is shown',
      'App rating prompt may be shown',
      'Screen is closed',
    ],
    successCriteria: [
      'Rating submission succeeds',
      'Success dialog appears',
      'App rating prompt works correctly',
      'Screen closes after completion',
    ],
    relatedTestCases: ['TC-ORDER-RATING-007', 'TC-ORDER-RATING-013', 'TC-ORDER-RATING-014'],
  },
  {
    id: 'UC-ORDER-RATING-008',
    title: 'Navigate Between Restaurant and Driver Rating',
    priority: 'High',
    userType: 'End User',
    description: 'Customer can navigate between restaurant and driver rating tabs. Back button behavior changes based on current tab.',
    preconditions: [
      'Rating screen is loaded',
      'Both restaurant and driver ratings are available',
    ],
    steps: [
      {
        step: 1,
        action: 'Customer is on restaurant rating tab',
        expectedResult: 'Restaurant rating is displayed',
        uiState: 'Restaurant rating form is shown',
        flutterFile: 'order_rating_viewmodel.dart:559-563',
      },
      {
        step: 2,
        action: 'Customer taps "Next" button',
        expectedResult: 'App switches to driver rating tab',
        uiState: 'Driver rating form is shown',
        flutterFile: 'rating_submit_button.dart:107-108',
      },
      {
        step: 3,
        action: 'Customer taps back button on driver rating tab',
        expectedResult: 'App switches back to restaurant rating tab',
        uiState: 'Restaurant rating form is shown again',
        flutterFile: 'order_rating_screen.dart:142-152',
      },
      {
        step: 4,
        action: 'Customer taps back button on restaurant rating tab',
        expectedResult: 'Rating screen is closed',
        uiState: 'Previous screen is shown',
        flutterFile: 'order_rating_screen.dart:142-152',
      },
    ],
    postconditions: [
      'Tab navigation works correctly',
      'Back button behavior is correct',
      'Rating data is preserved when switching tabs',
    ],
    successCriteria: [
      'Tab switching works smoothly',
      'Back button works correctly',
      'Data is preserved',
    ],
    relatedTestCases: ['TC-ORDER-RATING-015'],
  },
  {
    id: 'UC-ORDER-RATING-009',
    title: 'Handle Rating Load Failure',
    priority: 'High',
    userType: 'End User',
    description: 'If rating options fail to load, app shows error message and allows retry.',
    preconditions: [
      'Rating screen is opened',
      'Network request fails or server error occurs',
    ],
    steps: [
      {
        step: 1,
        action: 'App attempts to fetch rating options',
        expectedResult: 'API call fails',
        uiState: 'Loading indicator shows',
        flutterFile: 'order_rating_viewmodel.dart:41-69',
      },
      {
        step: 2,
        action: 'App receives error response',
        expectedResult: 'Error state is set',
        uiState: 'Error widget is displayed',
        flutterFile: 'order_rating_screen.dart:40-52',
      },
      {
        step: 3,
        action: 'App shows error message and retry button',
        expectedResult: 'Error UI is displayed',
        uiState: 'Error message and retry button are shown',
        flutterFile: 'order_rating_screen.dart:134-138',
      },
      {
        step: 4,
        action: 'Customer taps retry button',
        expectedResult: 'App retries fetching rating options',
        uiState: 'Loading indicator shows again',
        flutterFile: 'order_rating_screen.dart:137',
      },
    ],
    postconditions: [
      'Error is handled gracefully',
      'Retry option is available',
      'User can recover from error',
    ],
    successCriteria: [
      'Error message is clear',
      'Retry works correctly',
      'User can complete rating after retry',
    ],
    relatedTestCases: ['TC-ORDER-RATING-016'],
  },
  {
    id: 'UC-ORDER-RATING-010',
    title: 'Handle Rating Submission Failure',
    priority: 'High',
    userType: 'End User',
    description: 'If rating submission fails, app shows error message and allows customer to retry submission.',
    preconditions: [
      'Rating form is completed',
      'Customer taps submit button',
      'Network request fails or server error occurs',
    ],
    steps: [
      {
        step: 1,
        action: 'App attempts to submit rating',
        expectedResult: 'API call fails',
        uiState: 'Loading indicator shows',
        flutterFile: 'order_rating_viewmodel.dart:203-224',
      },
      {
        step: 2,
        action: 'App receives error response',
        expectedResult: 'Error state is set',
        uiState: 'Error dialog is shown',
        flutterFile: 'order_rating_screen.dart:81-92',
      },
      {
        step: 3,
        action: 'App shows error message',
        expectedResult: 'Error message is displayed',
        uiState: 'Error dialog appears',
        flutterFile: 'order_rating_screen.dart:85-88',
      },
      {
        step: 4,
        action: 'Customer can retry submission',
        expectedResult: 'Rating data is preserved',
        uiState: 'Submit button is enabled again',
        flutterFile: 'order_rating_viewmodel.dart:203-224',
      },
    ],
    postconditions: [
      'Error is handled gracefully',
      'Rating data is preserved',
      'Customer can retry submission',
    ],
    successCriteria: [
      'Error message is clear',
      'Rating data is not lost',
      'Retry works correctly',
    ],
    relatedTestCases: ['TC-ORDER-RATING-017'],
  },
];

