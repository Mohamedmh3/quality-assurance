import type { EdgeCase } from '@/lib/types';

export const homeFeedEdgeCases: EdgeCase[] = [
  {
    id: 'EC-HOMEFEED-001',
    title: 'Home Feed Fails to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Critical',
    triggerCondition: 'Network request fails or timeout occurs when fetching home list',
    expectedBehavior: 'App shows retry widget with error message, user can tap retry to reload',
    uiHandling: {
      errorMessage: 'home_fetching_Data',
      recoveryOptions: [
        'Show retry button',
        'Allow pull-to-refresh',
        'Display error message in user-friendly language',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_feed_view.dart:176-179'],
      validationRules: ['Check network connectivity', 'Handle timeout exceptions'],
      apiErrorCodes: ['500', '503', 'TIMEOUT'],
    },
    relatedTestCases: ['TC-HOMEFEED-026'],
  },
  {
    id: 'EC-HOMEFEED-002',
    title: 'Empty Home List Returned',
    category: 'Data',
    likelihood: 'Low',
    impact: 'High',
    triggerCondition: 'Backend returns empty home list array',
    expectedBehavior: 'App shows empty state message or retry widget, allows user to refresh',
    uiHandling: {
      errorMessage: 'No content available',
      recoveryOptions: [
        'Show empty state with helpful message',
        'Provide refresh option',
        'Suggest checking location settings',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_feed_view.dart:173-175'],
      validationRules: ['Check if homeList.isEmpty'],
    },
    relatedTestCases: ['TC-HOMEFEED-027'],
  },
  {
    id: 'EC-HOMEFEED-003',
    title: 'Section Data URL Fails to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'A specific section\'s dataUrl returns error or empty data',
    expectedBehavior: 'App skips that section and continues loading next sections, removes loading indicator',
    uiHandling: {
      errorMessage: 'Section failed to load (silent failure)',
      recoveryOptions: [
        'Skip failed section',
        'Continue loading other sections',
        'Remove loading indicator for failed section',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:743-747'],
      validationRules: ['Catch exceptions per section', 'Check if item.data.isEmpty'],
    },
    relatedTestCases: ['TC-HOMEFEED-028'],
  },
  {
    id: 'EC-HOMEFEED-004',
    title: 'Refresh Throttling Prevents Update',
    category: 'Performance',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User tries to refresh too soon after last refresh (within throttle duration)',
    expectedBehavior: 'Refresh is blocked until throttle period passes, or after 5 retry attempts it proceeds',
    uiHandling: {
      errorMessage: 'Refresh too soon (no message shown, refresh just doesn\'t happen)',
      recoveryOptions: [
        'Wait for throttle period to pass',
        'Pull refresh 5 times to override throttle',
        'Refresh completes after retry threshold',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1150-1163'],
      validationRules: ['Check time difference from last refresh', 'Count retry attempts'],
    },
    relatedTestCases: ['TC-HOMEFEED-004'],
  },
  {
    id: 'EC-HOMEFEED-005',
    title: 'Latest Order API Throttled',
    category: 'Performance',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'fetchLatestOrder() called too frequently (within 5 seconds)',
    expectedBehavior: 'API call is skipped, returns cached latestOrderList instead',
    uiHandling: {
      errorMessage: 'Throttling latest order fetch - too soon (logged, no user message)',
      recoveryOptions: [
        'Use cached order data',
        'Wait for throttle period',
        'Force refresh with force=true parameter',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1274-1281'],
      validationRules: ['Check time difference from last fetch', 'Return cached data if throttled'],
    },
    relatedTestCases: ['TC-HOMEFEED-029'],
  },
  {
    id: 'EC-HOMEFEED-006',
    title: 'No Active Orders',
    category: 'Data',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User has no active orders, fetchLatestOrder() returns empty list',
    expectedBehavior: 'Latest order card section is hidden, feed continues normally',
    uiHandling: {
      errorMessage: 'No orders (section hidden, no error shown)',
      recoveryOptions: [
        'Hide order card section',
        'Continue showing other sections',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_widgets/order_status_widget/latest_order_widget.dart:39-40'],
      validationRules: ['Check if latestOrderList.isEmpty'],
    },
    relatedTestCases: ['TC-HOMEFEED-030'],
  },
  {
    id: 'EC-HOMEFEED-007',
    title: 'Order Deletion Fails',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'deleteOrder() API call fails or returns error',
    expectedBehavior: 'Error toast is shown, order remains in feed, user can retry',
    uiHandling: {
      errorMessage: 'Error message from API (shown in toast)',
      recoveryOptions: [
        'Show error toast',
        'Keep order in feed',
        'Allow user to retry deletion',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/service/feed_service.dart:564-569'],
      validationRules: ['Catch exceptions', 'Show error message'],
    },
    relatedTestCases: ['TC-HOMEFEED-031'],
  },
  {
    id: 'EC-HOMEFEED-008',
    title: 'Flash Sale Expires While Viewing',
    category: 'State',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Flash sale expiry date passes while user is viewing flash sale',
    expectedBehavior: 'Floating button disappears, flash sale bottom sheet closes if open',
    uiHandling: {
      errorMessage: 'Flash sale expired (no message, button just disappears)',
      recoveryOptions: [
        'Hide floating button',
        'Close flash sale bottom sheet',
        'Remove flash sale from display',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_widgets/flash_sale/viewmodel/flash_sale_viewmodel.dart:133-143'],
      validationRules: ['Check if expiryDate is after DateTime.now()'],
    },
    relatedTestCases: ['TC-HOMEFEED-032'],
  },
  {
    id: 'EC-HOMEFEED-009',
    title: 'Guest User Reaches Content Limit',
    category: 'Validation',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Guest user views allowed number of sections, more sections require login',
    expectedBehavior: 'Login prompt section appears, pull-up loading is disabled',
    uiHandling: {
      errorMessage: 'Login to see more (shown in login prompt section)',
      recoveryOptions: [
        'Show login prompt section',
        'Disable pull-up loading',
        'Allow user to login to continue',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:782-795'],
      validationRules: ['Count loaded sections', 'Check if user is logged in', 'Compare with allowedHomeListsCountForGuest'],
    },
    relatedTestCases: ['TC-HOMEFEED-033'],
  },
  {
    id: 'EC-HOMEFEED-010',
    title: 'WebSocket Connection Fails for Order Updates',
    category: 'Network',
    likelihood: 'Low',
    impact: 'Medium',
    triggerCondition: 'WebSocket fails to connect or disconnects while app is running',
    expectedBehavior: 'App falls back to polling via API, order updates still work but not real-time',
    uiHandling: {
      errorMessage: 'WebSocket error (logged, no user message)',
      recoveryOptions: [
        'Fall back to API polling',
        'Retry WebSocket connection',
        'Continue using API for updates',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1529-1553'],
      validationRules: ['Handle WebSocket errors', 'Fallback to API calls'],
    },
    relatedTestCases: ['TC-HOMEFEED-034'],
  },
  {
    id: 'EC-HOMEFEED-011',
    title: 'Points Earned Notification While App Closed',
    category: 'State',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'User earns points while app is closed, notification contains new_point data',
    expectedBehavior: 'When app opens, points earned dialog shows with celebration',
    uiHandling: {
      errorMessage: 'Points earned (shown in celebration dialog)',
      recoveryOptions: [
        'Show points earned dialog on app open',
        'Update points balance',
        'Display celebration animation',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:204-210'],
      validationRules: ['Check notification payload for new_point', 'Compare old and new points'],
    },
    relatedTestCases: ['TC-HOMEFEED-035'],
  },
  {
    id: 'EC-HOMEFEED-012',
    title: 'Onboarding Progress API Fails',
    category: 'Network',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'fetchOnboardingProgress() API call fails',
    expectedBehavior: 'Error flag is set, onboarding section is hidden, feed continues normally',
    uiHandling: {
      errorMessage: 'Onboarding progress error (silent failure, section hidden)',
      recoveryOptions: [
        'Set onboardingProgressError = true',
        'Hide onboarding section',
        'Continue loading other sections',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:559-562'],
      validationRules: ['Catch exceptions', 'Set error flag'],
    },
    relatedTestCases: ['TC-HOMEFEED-036'],
  },
  {
    id: 'EC-HOMEFEED-013',
    title: 'Survey Card Already Completed',
    category: 'State',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User has already completed onboarding survey, local flag is set',
    expectedBehavior: 'Survey card is hidden, not fetched from API',
    uiHandling: {
      errorMessage: 'Survey completed (card hidden, no message)',
      recoveryOptions: [
        'Check local completion flag',
        'Skip API call if completed',
        'Hide survey card',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:577-583'],
      validationRules: ['Check ONBOARDING_SURVEY_COMPLETED flag'],
    },
    relatedTestCases: ['TC-HOMEFEED-037'],
  },
  {
    id: 'EC-HOMEFEED-014',
    title: 'Multiple Orders in Latest Order List',
    category: 'Data',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User has multiple active orders, fetchLatestOrder() returns list with 2+ orders',
    expectedBehavior: 'Carousel displays all orders, user can swipe between them, indicators show current order',
    uiHandling: {
      errorMessage: 'Multiple orders (carousel shows all, no error)',
      recoveryOptions: [
        'Display carousel with all orders',
        'Show page indicators',
        'Allow swiping between orders',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_widgets/order_status_widget/latest_order_widget.dart:49-84'],
      validationRules: ['Check latestOrderList.length', 'Create carousel if > 1'],
    },
    relatedTestCases: ['TC-HOMEFEED-038'],
  },
  {
    id: 'EC-HOMEFEED-015',
    title: 'Banner Images Fail to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'Banner image URLs return 404 or fail to load',
    expectedBehavior: 'Default placeholder image shows, banner still functional, navigation works',
    uiHandling: {
      errorMessage: 'Image load error (placeholder shown, no error message)',
      recoveryOptions: [
        'Show placeholder image',
        'Keep banner functional',
        'Allow navigation even if image fails',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/view/home_widgets/banner_widgets/home_banner_card_widget.dart'],
      validationRules: ['Handle image load errors', 'Show placeholder'],
    },
    relatedTestCases: ['TC-HOMEFEED-039'],
  },
  {
    id: 'EC-HOMEFEED-016',
    title: 'Voucher Expires While Viewing',
    category: 'State',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Voucher expiry date passes while user is viewing vouchers',
    expectedBehavior: 'Expired vouchers are filtered out, voucher count updates, expired indicator shows',
    uiHandling: {
      errorMessage: 'Voucher expired (shown in UI, filtered from list)',
      recoveryOptions: [
        'Filter expired vouchers',
        'Update voucher count',
        'Show expiry indicator',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:605-623'],
      validationRules: ['Check voucher expiry dates', 'Filter expired vouchers'],
    },
    relatedTestCases: ['TC-HOMEFEED-040'],
  },
  {
    id: 'EC-HOMEFEED-017',
    title: 'Achievements List Empty',
    category: 'Data',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'User has no incomplete achievements, fetchAchievementsList() returns empty after filtering',
    expectedBehavior: 'Achievement carousel section is hidden, feed continues normally',
    uiHandling: {
      errorMessage: 'No achievements (section hidden, no error)',
      recoveryOptions: [
        'Hide achievement section',
        'Continue showing other sections',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1256'],
      validationRules: ['Filter completed achievements', 'Check if list is empty'],
    },
    relatedTestCases: ['TC-HOMEFEED-041'],
  },
  {
    id: 'EC-HOMEFEED-018',
    title: 'Pickup Home List Not Loaded When Switching',
    category: 'State',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'User switches to pickup mode but pickupHomeList is empty',
    expectedBehavior: 'App fetches pickup home list, shows loading, then displays pickup content',
    uiHandling: {
      errorMessage: 'Loading pickup content (loading indicator shown)',
      recoveryOptions: [
        'Fetch pickup home list',
        'Show loading indicator',
        'Switch to pickup content when loaded',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:315-323'],
      validationRules: ['Check if pickupHomeList.isEmpty', 'Fetch if empty'],
    },
    relatedTestCases: ['TC-HOMEFEED-042'],
  },
  {
    id: 'EC-HOMEFEED-019',
    title: 'Notification Permission Denied',
    category: 'Validation',
    likelihood: 'Low',
    impact: 'Medium',
    triggerCondition: 'User denies notification permission, app tries to show notification dialog',
    expectedBehavior: 'Permission request dialog shows, user can enable in settings',
    uiHandling: {
      errorMessage: 'Enable notifications (shown in permission dialog)',
      recoveryOptions: [
        'Show permission request dialog',
        'Provide link to app settings',
        'Allow app to work without notifications',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1075-1096'],
      validationRules: ['Check notification permission status', 'Show dialog if denied'],
    },
    relatedTestCases: ['TC-HOMEFEED-043'],
  },
  {
    id: 'EC-HOMEFEED-020',
    title: 'Flash Sale Refresh Rate Not Configured',
    category: 'State',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'flashSaleRefreshRate is 0 or null in settings',
    expectedBehavior: 'Periodic flash sale check is skipped, only initial fetch occurs',
    uiHandling: {
      errorMessage: 'Flash sale refresh disabled (no error, feature just disabled)',
      recoveryOptions: [
        'Skip periodic fetch',
        'Only fetch on initial load',
        'Check manually via refresh',
      ],
    },
    implementationNotes: {
      flutterFiles: ['home_feed_view_page/viewmodel/home_feed_viewmodel.dart:291-293'],
      validationRules: ['Check flashSaleRefreshRate != 0'],
    },
    relatedTestCases: ['TC-HOMEFEED-044'],
  },
];

