import type { EdgeCase } from '../types';

export const orderRatingEdgeCases: EdgeCase[] = [
  {
    id: 'EC-ORDER-RATING-001',
    title: 'Rating Options Fail to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Critical',
    triggerCondition: 'Network request to fetchOrderRating fails or server returns error',
    expectedBehavior: 'App shows error widget with retry button. Customer can retry loading rating options.',
    uiHandling: {
      errorMessage: 'Error message from server or generic "Something went wrong"',
      recoveryOptions: [
        'Tap retry button to reload rating options',
        'Check internet connection and try again',
        'Close and reopen rating screen',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:41-69', 'order_rating_screen.dart:40-52'],
      validationRules: ['Error state is set in fetchRatingState', 'Error widget is displayed'],
      apiErrorCodes: ['Network timeout', 'Server error (500)', 'Not found (404)'],
    },
    relatedTestCases: ['TC-ORDER-RATING-010'],
  },
  {
    id: 'EC-ORDER-RATING-002',
    title: 'Rating Submission Fails',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'Network request to rateOrderV2 fails or server returns error',
    expectedBehavior: 'App shows error dialog. Rating data is preserved. Customer can retry submission.',
    uiHandling: {
      errorMessage: 'Error message from server or generic error message',
      recoveryOptions: [
        'Tap OK to dismiss error',
        'Check internet connection',
        'Retry submission by tapping Send button again',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:203-224', 'order_rating_screen.dart:81-92'],
      validationRules: ['Error state is set in submitRatingState', 'Error dialog is shown'],
      apiErrorCodes: ['Network timeout', 'Server error (500)', 'Validation error (400)'],
    },
    relatedTestCases: ['TC-ORDER-RATING-011'],
  },
  {
    id: 'EC-ORDER-RATING-003',
    title: 'Star Rating Not Selected',
    category: 'Validation',
    likelihood: 'High',
    impact: 'Medium',
    triggerCondition: 'Customer tries to submit rating without selecting star rating',
    expectedBehavior: 'App shows validation error. Submit button is disabled or shows error. Customer must select star rating.',
    uiHandling: {
      errorMessage: 'Rating required validation flag is set',
      recoveryOptions: [
        'Select a star rating (1-5 stars)',
        'Validation error disappears when star is selected',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:72-114', 'rating_submit_button.dart:91-92'],
      validationRules: ['ratingRequiredValidation is true when star not selected', 'Submit button is disabled'],
    },
    relatedTestCases: ['TC-ORDER-RATING-008'],
  },
  {
    id: 'EC-ORDER-RATING-004',
    title: 'Required Options Not Selected',
    category: 'Validation',
    likelihood: 'High',
    impact: 'Medium',
    triggerCondition: 'Customer selects star rating but does not select required options (when selectionRequired is true)',
    expectedBehavior: 'App shows validation error. Options list border turns red. Customer must select at least one option.',
    uiHandling: {
      errorMessage: 'Selection required validation flag is set',
      recoveryOptions: [
        'Select at least one rating option',
        'Validation error disappears when option is selected',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:72-114', 'rating_options_list.dart:30-34'],
      validationRules: ['selectionRequiredValidation is true when required options not selected', 'Options list border turns red'],
    },
    relatedTestCases: ['TC-ORDER-RATING-009'],
  },
  {
    id: 'EC-ORDER-RATING-005',
    title: 'Required Notes Not Provided',
    category: 'Validation',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Customer selects option with noteRequired=true but does not provide note text',
    expectedBehavior: 'App shows validation error in notes field. Form validation fails. Customer must provide note text.',
    uiHandling: {
      errorMessage: '"Required" validation message in notes field',
      recoveryOptions: [
        'Type note text in the notes field',
        'Validation error disappears when note is provided',
      ],
    },
    implementationNotes: {
      flutterFiles: ['rating_section_widget.dart:209-214', 'order_rating_viewmodel.dart:117-121'],
      validationRules: ['Form validator checks if note is required and empty', 'Error message shows "Required"'],
    },
    relatedTestCases: ['TC-ORDER-RATING-017'],
  },
  {
    id: 'EC-ORDER-RATING-006',
    title: 'Required Images Not Uploaded',
    category: 'Validation',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Customer selects option with withImage=true but does not upload images',
    expectedBehavior: 'App shows error dialog when trying to submit. Customer must upload at least one image.',
    uiHandling: {
      errorMessage: '"image_upload_is_required" locale message',
      recoveryOptions: [
        'Tap Upload Image button',
        'Select at least one image',
        'Try submitting again',
      ],
    },
    implementationNotes: {
      flutterFiles: ['rating_submit_button.dart:66-75'],
      validationRules: ['Check if selected option has withImage=true', 'Check if images list is empty'],
    },
    relatedTestCases: ['TC-ORDER-RATING-018'],
  },
  {
    id: 'EC-ORDER-RATING-007',
    title: 'Driver Rating Not Available',
    category: 'Data',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'Rating model has driver section as null (pickup orders or no driver)',
    expectedBehavior: 'App skips driver rating step. Submit button shows "Send" instead of "Next". Rating is submitted immediately after restaurant rating.',
    uiHandling: {
      errorMessage: 'No error message - feature works as designed',
      recoveryOptions: [
        'Complete restaurant rating',
        'Tap Send button',
        'Rating is submitted immediately',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:164-165', 'rating_submit_button.dart:56-60'],
      validationRules: ['isOneModelNull checks if driver or restaurant is null', 'Button text changes based on isOneModelNull'],
    },
    relatedTestCases: ['TC-ORDER-RATING-019'],
  },
  {
    id: 'EC-ORDER-RATING-008',
    title: 'Restaurant Rating Not Available',
    category: 'Data',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Rating model has restaurant section as null (edge case)',
    expectedBehavior: 'App shows only driver rating. Submit button shows "Send". Rating is submitted immediately.',
    uiHandling: {
      errorMessage: 'No error message - feature works as designed',
      recoveryOptions: [
        'Complete driver rating',
        'Tap Send button',
        'Rating is submitted immediately',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:164-165', 'rating_submit_button.dart:56-60'],
      validationRules: ['isOneModelNull checks if driver or restaurant is null'],
    },
    relatedTestCases: ['TC-ORDER-RATING-020'],
  },
  {
    id: 'EC-ORDER-RATING-009',
    title: 'Image Upload in Progress During Submission',
    category: 'Concurrency',
    likelihood: 'Low',
    impact: 'Medium',
    triggerCondition: 'Customer taps submit button while images are still uploading',
    expectedBehavior: 'App shows error dialog preventing submission. Customer must wait for images to finish uploading.',
    uiHandling: {
      errorMessage: '"image_is_uploading" locale message',
      recoveryOptions: [
        'Wait for images to finish uploading',
        'Try submitting again after upload completes',
      ],
    },
    implementationNotes: {
      flutterFiles: ['rating_submit_button.dart:77-83'],
      validationRules: ['Check imageApiLoading state before submission', 'Show error if images are uploading'],
    },
    relatedTestCases: ['TC-ORDER-RATING-021'],
  },
  {
    id: 'EC-ORDER-RATING-010',
    title: 'Maximum Image Limit Reached',
    category: 'Validation',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Customer tries to upload more images than maxPhotoAvailable limit',
    expectedBehavior: 'Image picker prevents selecting more images. Customer can only upload up to the limit.',
    uiHandling: {
      errorMessage: 'Image picker shows limit message or prevents selection',
      recoveryOptions: [
        'Remove some images to make room',
        'Upload images within the limit',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:154-155'],
      validationRules: ['maxPhotoAvailable is set from ratingModel.canUpload', 'ImagePickerViewModel enforces limit'],
    },
    relatedTestCases: ['TC-ORDER-RATING-022'],
  },
  {
    id: 'EC-ORDER-RATING-011',
    title: 'Rating Type Has No Options',
    category: 'Data',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Selected rating type has empty options list',
    expectedBehavior: 'App shows rating type but no options list. Customer can submit rating without selecting options (if selectionRequired is false).',
    uiHandling: {
      errorMessage: 'No error message - options list is simply not shown',
      recoveryOptions: [
        'Complete rating without selecting options',
        'Submit rating if selection is not required',
      ],
    },
    implementationNotes: {
      flutterFiles: ['rating_options_list.dart:72-74'],
      validationRules: ['Options list widget checks if options.isEmpty', 'Widget returns SizedBox.shrink() if empty'],
    },
    relatedTestCases: ['TC-ORDER-RATING-023'],
  },
  {
    id: 'EC-ORDER-RATING-012',
    title: 'Sub-Option Requires Dish Selection But No Dishes Available',
    category: 'Data',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Selected option has sub-options that require dish selection, but order has no dishes',
    expectedBehavior: 'App shows sub-options but no dish selection. Customer can select sub-option without dish selection.',
    uiHandling: {
      errorMessage: 'No error message - dish selection is simply not shown',
      recoveryOptions: [
        'Select sub-option without dish selection',
        'Complete rating normally',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:346-390'],
      validationRules: ['Dish selection is optional', 'Sub-option can be selected without dishes'],
    },
    relatedTestCases: ['TC-ORDER-RATING-024'],
  },
  {
    id: 'EC-ORDER-RATING-013',
    title: 'Back Button Pressed During Submission',
    category: 'State',
    likelihood: 'Low',
    impact: 'Medium',
    triggerCondition: 'Customer presses back button while rating is being submitted',
    expectedBehavior: 'Back button is disabled during submission. Customer cannot navigate away until submission completes.',
    uiHandling: {
      errorMessage: 'Back button does nothing or shows "Please wait" message',
      recoveryOptions: [
        'Wait for submission to complete',
        'Back button becomes enabled after submission',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_screen.dart:142-152'],
      validationRules: ['onWillPop returns false if submitRatingState.isLoading', 'Back button is disabled during loading'],
    },
    relatedTestCases: ['TC-ORDER-RATING-025'],
  },
  {
    id: 'EC-ORDER-RATING-014',
    title: 'Back Button Pressed on Driver Rating Tab',
    category: 'State',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'Customer presses back button while on driver rating tab',
    expectedBehavior: 'App switches back to restaurant rating tab instead of closing screen. Back button behavior changes based on tab.',
    uiHandling: {
      errorMessage: 'No error message - navigation works as designed',
      recoveryOptions: [
        'Complete driver rating',
        'Or press back again to close screen',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_screen.dart:142-152'],
      validationRules: ['onWillPop checks isDriverRatingTab', 'If true, changePage to restaurant tab and return false'],
    },
    relatedTestCases: ['TC-ORDER-RATING-012'],
  },
  {
    id: 'EC-ORDER-RATING-015',
    title: 'Rating Version Mismatch',
    category: 'Data',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Rating model has ratingVersion that differs from expected version',
    expectedBehavior: 'App handles both rating versions correctly. Rating version 2 uses star values directly, version 1 uses type values.',
    uiHandling: {
      errorMessage: 'No error message - version is handled automatically',
      recoveryOptions: [
        'App handles version automatically',
        'Rating works correctly regardless of version',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:496-557'],
      validationRules: ['Rating version determines how star values are mapped to types', 'Version 2 uses star directly'],
    },
    relatedTestCases: ['TC-ORDER-RATING-026'],
  },
  {
    id: 'EC-ORDER-RATING-016',
    title: 'App Rating Prompt Fails to Show',
    category: 'UI',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Both ratings are 4+ stars but app rating prompt fails to show or is dismissed',
    expectedBehavior: 'Rating submission still succeeds. Success dialog is shown. App rating prompt is optional.',
    uiHandling: {
      errorMessage: 'No error message - app rating is optional',
      recoveryOptions: [
        'Rating submission succeeds regardless',
        'Success dialog is shown',
        'Customer can rate app later',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_screen.dart:63-73'],
      validationRules: ['App rating prompt is shown if both ratings >= 4', 'Prompt failure does not affect rating submission'],
    },
    relatedTestCases: ['TC-ORDER-RATING-013', 'TC-ORDER-RATING-030'],
  },
  {
    id: 'EC-ORDER-RATING-017',
    title: 'Image Upload Fails',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'Customer selects images but upload to server fails',
    expectedBehavior: 'ImagePickerViewModel handles upload failure. Error is shown. Customer can retry upload or submit without images (if not required).',
    uiHandling: {
      errorMessage: 'Image upload error message',
      recoveryOptions: [
        'Retry image upload',
        'Remove failed images and try again',
        'Submit without images if not required',
      ],
    },
    implementationNotes: {
      flutterFiles: ['rating_submit_button.dart:77-83'],
      validationRules: ['ImagePickerViewModel handles upload errors', 'Upload state is tracked'],
    },
    relatedTestCases: ['TC-ORDER-RATING-027'],
  },
  {
    id: 'EC-ORDER-RATING-018',
    title: 'Rating Options Change During Session',
    category: 'State',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Rating options are updated on server while customer is filling rating form',
    expectedBehavior: 'App uses cached rating options. Changes are not reflected until customer closes and reopens rating screen.',
    uiHandling: {
      errorMessage: 'No error message - cached data is used',
      recoveryOptions: [
        'Complete rating with current options',
        'Close and reopen to get updated options',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:41-69'],
      validationRules: ['Rating options are fetched once on init', 'Options are cached in state'],
    },
    relatedTestCases: ['TC-ORDER-RATING-028'],
  },
  {
    id: 'EC-ORDER-RATING-019',
    title: 'Multiple Sub-Options Selected for Same Option',
    category: 'State',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Customer selects multiple sub-options for the same option (should only allow one)',
    expectedBehavior: 'App replaces previous sub-option with new one. Only one sub-option per option is allowed.',
    uiHandling: {
      errorMessage: 'No error message - previous selection is replaced automatically',
      recoveryOptions: [
        'Previous sub-option is automatically deselected',
        'New sub-option is selected',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:298-344'],
      validationRules: ['removeWhere removes existing sub-option for same optionId', 'Only one sub-option per option'],
    },
    relatedTestCases: ['TC-ORDER-RATING-015'],
  },
  {
    id: 'EC-ORDER-RATING-020',
    title: 'Dish Selection Replaces Previous Selection',
    category: 'State',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'Customer selects a dish for sub-option, then selects a different dish',
    expectedBehavior: 'App replaces previous dish selection with new one. Only one dish can be selected per sub-option.',
    uiHandling: {
      errorMessage: 'No error message - previous selection is replaced automatically',
      recoveryOptions: [
        'Previous dish is automatically deselected',
        'New dish is selected',
      ],
    },
    implementationNotes: {
      flutterFiles: ['order_rating_viewmodel.dart:346-390'],
      validationRules: ['Dish selection replaces previous selection', 'Only one dish per sub-option'],
    },
    relatedTestCases: ['TC-ORDER-RATING-016'],
  },
];

