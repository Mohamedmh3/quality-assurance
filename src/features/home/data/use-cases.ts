import type { UseCase } from '@/lib/types';

export const homeUseCases: UseCase[] = [
  {
    id: 'UC-HOME-001',
    title: 'Navigate Between App Sections via Bottom Navigation',
    priority: 'Critical',
    userType: 'End User',
    description: 'Users can switch between different main sections of the app (Home Feed, Search, Wallet, My Orders, Profile) using the bottom navigation bar.',
    preconditions: [
      'App is open and running',
      'User is on any main screen',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps on a bottom navigation icon',
        expectedResult: 'The corresponding screen loads and displays',
        uiState: 'Bottom navigation highlights the selected tab',
        flutterFile: 'home/widget_home_bottom_navigation_bar.dart:65-161',
      },
      {
        step: 2,
        action: 'System updates the selected index',
        expectedResult: 'ViewModel selectedIndex changes to match tapped tab',
        uiState: 'New screen content replaces previous content',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:415-436',
      },
    ],
    postconditions: [
      'User is viewing the selected section',
      'Bottom navigation shows active state on selected tab',
    ],
    successCriteria: [
      'Navigation completes without lag or visual glitches',
      'Content loads appropriately for selected section',
    ],
    relatedTestCases: ['TC-HOME-001', 'TC-HOME-002'],
  },
  {
    id: 'UC-HOME-002',
    title: 'Handle Location Permission Request',
    priority: 'Critical',
    userType: 'End User',
    description: 'When the app needs user location for delivery, it requests location permissions and handles various permission states.',
    preconditions: [
      'App is starting or user has no saved address',
      'Location services available on device',
    ],
    steps: [
      {
        step: 1,
        action: 'System checks current location permission status',
        expectedResult: 'Permission status is determined',
        uiState: 'May show loading indicator',
        flutterFile: 'home/view/home_view.dart:75-93',
      },
      {
        step: 2,
        action: 'If permission not granted, show LocationPermissionsView',
        expectedResult: 'Location permission request UI displays',
        uiState: 'User sees location permission explanation screen',
        flutterFile: 'home/view/home_view.dart:237',
      },
      {
        step: 3,
        action: 'User grants or denies location permission',
        expectedResult: 'App proceeds based on user choice',
        uiState: 'Home feed loads or out-of-coverage view shown',
        flutterFile: 'home/view/home_permission_view.dart:32-63',
      },
    ],
    postconditions: [
      'Location permission state is recorded',
      'App displays appropriate content based on location availability',
    ],
    successCriteria: [
      'Permission dialog appears correctly',
      'App handles both grant and denial gracefully',
    ],
    relatedTestCases: ['TC-HOME-003', 'TC-HOME-004'],
  },
  {
    id: 'UC-HOME-003',
    title: 'Handle Push Notification When App is Open',
    priority: 'High',
    userType: 'End User',
    description: 'When a push notification arrives while the app is running, it\'s processed and appropriate action is taken based on notification type.',
    preconditions: [
      'App is open and running',
      'User has notification permissions enabled',
      'Firebase messaging is configured',
    ],
    steps: [
      {
        step: 1,
        action: 'Push notification received via FirebaseMessaging.onMessageOpenedApp',
        expectedResult: 'Notification data is parsed',
        uiState: 'App processes notification silently',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:82-146',
      },
      {
        step: 2,
        action: 'System identifies notification type (order, voucher, points, etc.)',
        expectedResult: 'Appropriate handler is called based on type',
        uiState: 'Dialog or navigation occurs',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:95-145',
      },
      {
        step: 3,
        action: 'Show notification dialog with options',
        expectedResult: 'User can view details or dismiss',
        uiState: 'Bottom sheet with notification message appears',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:300-410',
      },
    ],
    postconditions: [
      'Notification is acknowledged',
      'User can take action on notification content',
    ],
    successCriteria: [
      'All notification types are handled correctly',
      'Analytics events are logged',
    ],
    relatedTestCases: ['TC-HOME-005', 'TC-HOME-006'],
  },
  {
    id: 'UC-HOME-004',
    title: 'Handle App Launch from Notification',
    priority: 'High',
    userType: 'End User',
    description: 'When user taps a notification while app is closed, the app opens and processes the notification to show relevant content.',
    preconditions: [
      'App was closed or in background',
      'User tapped on a push notification',
    ],
    steps: [
      {
        step: 1,
        action: 'App initializes and checks for initial notification message',
        expectedResult: 'Pending notification data is retrieved',
        uiState: 'App opens with splash screen',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:148-214',
      },
      {
        step: 2,
        action: 'Parse notification payload and determine action',
        expectedResult: 'Notification type identified',
        uiState: 'Home screen loads',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:154-168',
      },
      {
        step: 3,
        action: 'Navigate to appropriate screen or show dialog',
        expectedResult: 'User sees relevant content',
        uiState: 'Order details, vouchers, or notification dialog shown',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:170-213',
      },
    ],
    postconditions: [
      'App is fully loaded',
      'User sees content related to notification',
    ],
    successCriteria: [
      'Deep link navigation works correctly',
      'No crashes on malformed notification data',
    ],
    relatedTestCases: ['TC-HOME-007'],
  },
  {
    id: 'UC-HOME-005',
    title: 'Show Points Earned Dialog',
    priority: 'Medium',
    userType: 'End User',
    description: 'When user earns loyalty points, a celebratory dialog appears showing the number of points earned.',
    preconditions: [
      'User is logged in',
      'Points earned notification received',
    ],
    steps: [
      {
        step: 1,
        action: 'System receives new_point notification data',
        expectedResult: 'Points value is extracted',
        uiState: 'Home screen visible',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:135-142',
      },
      {
        step: 2,
        action: 'Show celebratory points dialog',
        expectedResult: 'Dialog displays with points earned',
        uiState: 'Congratulations dialog with points count and animated background',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:217-298',
      },
      {
        step: 3,
        action: 'User taps OK to dismiss',
        expectedResult: 'Dialog closes',
        uiState: 'Return to previous screen',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:284-290',
      },
    ],
    postconditions: [
      'User is aware of points earned',
      'Dialog is dismissed',
    ],
    successCriteria: [
      'Points display correctly',
      'Animation plays smoothly',
    ],
    relatedTestCases: ['TC-HOME-008'],
  },
  {
    id: 'UC-HOME-006',
    title: 'Vote for Out-of-Coverage Location',
    priority: 'Medium',
    userType: 'End User',
    description: 'When user is in an area not covered by delivery service, they can vote to request coverage in their area.',
    preconditions: [
      'User location is outside delivery coverage area',
      'User has not already voted',
    ],
    steps: [
      {
        step: 1,
        action: 'System checks if location is within coverage',
        expectedResult: 'Out of coverage detected',
        uiState: 'Vote location view displayed',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:444-449',
      },
      {
        step: 2,
        action: 'User taps "Notify Me" button',
        expectedResult: 'Vote API is called with user coordinates',
        uiState: 'Loading indicator on button',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:451-464',
      },
      {
        step: 3,
        action: 'Vote successfully recorded',
        expectedResult: 'Button state changes to voted',
        uiState: 'Toast message confirms vote recorded',
        flutterFile: 'home/view/home_view.dart:255-274',
      },
    ],
    postconditions: [
      'Vote is recorded in system',
      'Button is disabled to prevent duplicate votes',
    ],
    successCriteria: [
      'API call succeeds',
      'User feedback is provided',
    ],
    relatedTestCases: ['TC-HOME-009'],
  },
  {
    id: 'UC-HOME-007',
    title: 'Require Login for My Orders Tab',
    priority: 'High',
    userType: 'End User',
    description: 'When a guest user tries to access My Orders, they are prompted to log in first.',
    preconditions: [
      'User is not logged in (guest mode)',
      'User attempts to tap My Orders tab',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps My Orders in bottom navigation',
        expectedResult: 'Login check is performed',
        uiState: 'Bottom navigation interaction',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:418-434',
      },
      {
        step: 2,
        action: 'System detects user is not logged in',
        expectedResult: 'Login prompt bottom sheet appears',
        uiState: 'Bottom sheet with login invitation',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:419-433',
      },
      {
        step: 3,
        action: 'User can choose to login or dismiss',
        expectedResult: 'Navigate to login or close dialog',
        uiState: 'Login screen or return to current tab',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:423-427',
      },
    ],
    postconditions: [
      'User is on login screen or previous tab',
      'My Orders tab not selected if not logged in',
    ],
    successCriteria: [
      'Guest users cannot access My Orders directly',
      'Login flow is smooth and intuitive',
    ],
    relatedTestCases: ['TC-HOME-010', 'TC-HOME-011'],
  },
  {
    id: 'UC-HOME-008',
    title: 'Handle Back Button Press',
    priority: 'High',
    userType: 'End User',
    description: 'When user presses back button, the app handles it contextually - returning to home tab, scrolling to top, or exiting app.',
    preconditions: [
      'User is on home screen',
      'User presses device back button',
    ],
    steps: [
      {
        step: 1,
        action: 'User presses back button',
        expectedResult: 'onPopUp method is called',
        uiState: 'System evaluates current state',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:466-492',
      },
      {
        step: 2,
        action: 'If on non-home tab, switch to home tab (index 0)',
        expectedResult: 'Navigation changes to home feed',
        uiState: 'Home feed displayed',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:472-474',
      },
      {
        step: 3,
        action: 'If on home tab and scrolled, scroll to top',
        expectedResult: 'Content scrolls to top smoothly',
        uiState: 'Animated scroll to top',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:477-486',
      },
      {
        step: 4,
        action: 'If on home tab at top, allow app exit',
        expectedResult: 'App can be closed',
        uiState: 'App exit confirmation or direct exit',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:488',
      },
    ],
    postconditions: [
      'App responds appropriately to back press',
      'Tutorial coach mark is finished if active',
    ],
    successCriteria: [
      'No accidental app exits',
      'Smooth navigation flow',
    ],
    relatedTestCases: ['TC-HOME-012', 'TC-HOME-013'],
  },
  {
    id: 'UC-HOME-009',
    title: 'Spin Fortune Wheel for Rewards',
    priority: 'Medium',
    userType: 'End User',
    description: 'Users can spin a fortune wheel to win vouchers and rewards when they have available spins.',
    preconditions: [
      'User is logged in',
      'User has available spin trials (trailsCount > 0)',
      'Spinner rewards are loaded',
    ],
    steps: [
      {
        step: 1,
        action: 'User opens spinner view',
        expectedResult: 'Fortune wheel loads with available rewards',
        uiState: 'Animated gradient background with fortune wheel',
        flutterFile: 'home/spinner/view/spinner_view.dart:48-61',
      },
      {
        step: 2,
        action: 'User taps Spin button',
        expectedResult: 'API call to makeSpin endpoint',
        uiState: 'Button shows loading state',
        flutterFile: 'home/spinner/controller/spinner_viewmodel.dart:106-121',
      },
      {
        step: 3,
        action: 'Wheel spins and lands on result',
        expectedResult: 'Wheel animation completes at winning segment',
        uiState: 'Wheel spins for 3 seconds then stops',
        flutterFile: 'home/spinner/view/spinner_view.dart:168-188',
      },
      {
        step: 4,
        action: 'Show congratulations dialog with prize',
        expectedResult: 'Prize details displayed with confetti',
        uiState: 'Bottom sheet with confetti animation',
        flutterFile: 'home/spinner/view/spinner_view.dart:191-310',
      },
    ],
    postconditions: [
      'Spin count decremented',
      'Voucher added to user account if applicable',
    ],
    successCriteria: [
      'Wheel lands on correct prize segment',
      'User receives their reward',
    ],
    relatedTestCases: ['TC-HOME-014', 'TC-HOME-015'],
  },
  {
    id: 'UC-HOME-010',
    title: 'Add Spin Code for Extra Trials',
    priority: 'Low',
    userType: 'End User',
    description: 'Users can enter promotional codes to receive additional spinner trials.',
    preconditions: [
      'User is logged in',
      'User is on spinner view',
      'User has a valid spin code',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps "Get Spin by Code" button',
        expectedResult: 'Code entry bottom sheet appears',
        uiState: 'Text field for entering code',
        flutterFile: 'home/spinner/view/spinner_view.dart:382-448',
      },
      {
        step: 2,
        action: 'User enters code and taps Submit',
        expectedResult: 'Code validated via API',
        uiState: 'Loading indicator during validation',
        flutterFile: 'home/spinner/controller/spinner_viewmodel.dart:90-103',
      },
      {
        step: 3,
        action: 'Code validated successfully',
        expectedResult: 'Trials count increases',
        uiState: 'Bottom sheet closes, spin button shows updated count',
        flutterFile: 'home/spinner/controller/spinner_viewmodel.dart:95-98',
      },
    ],
    postconditions: [
      'User has additional spin trials',
      'Code is consumed (cannot be reused)',
    ],
    successCriteria: [
      'Valid codes add trials',
      'Invalid codes show error message',
    ],
    relatedTestCases: ['TC-HOME-016'],
  },
  {
    id: 'UC-HOME-011',
    title: 'Show Login Prompt in Bottom Bar for Guest Users',
    priority: 'Medium',
    userType: 'End User',
    description: 'Guest users see a login prompt banner above the bottom navigation bar encouraging them to sign in.',
    preconditions: [
      'User is not logged in',
      'User is on Home or Search tab',
      'Location is available and not in vote/denied state',
    ],
    steps: [
      {
        step: 1,
        action: 'System detects guest user on eligible tab',
        expectedResult: 'Login banner is rendered above bottom nav',
        uiState: 'Orange banner with "Login and enjoy more" message',
        flutterFile: 'home/widget_home_bottom_navigation_bar.dart:32-64',
      },
      {
        step: 2,
        action: 'User taps "Login Now" button',
        expectedResult: 'Navigate to phone number entry view',
        uiState: 'Login flow starts',
        flutterFile: 'home/widget_home_bottom_navigation_bar.dart:51-58',
      },
    ],
    postconditions: [
      'User is in login flow',
      'Analytics event logged',
    ],
    successCriteria: [
      'Banner shows only for guest users',
      'Login navigation works correctly',
    ],
    relatedTestCases: ['TC-HOME-017'],
  },
  {
    id: 'UC-HOME-012',
    title: 'Update Current Location to Server',
    priority: 'Medium',
    userType: 'End User',
    description: 'When app goes to background, the current user location is sent to the server for analytics and service optimization.',
    preconditions: [
      'User is logged in',
      'Location permission granted',
      'Cooldown period (60 seconds) has passed',
    ],
    steps: [
      {
        step: 1,
        action: 'App lifecycle changes to paused (background)',
        expectedResult: 'Location update check triggered',
        uiState: 'App going to background',
        flutterFile: 'home/view/home_view.dart:101-119',
      },
      {
        step: 2,
        action: 'Check if location request can be made',
        expectedResult: 'LocationRequestManager validates request',
        uiState: 'No visible change',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:496-506',
      },
      {
        step: 3,
        action: 'Send current location to server',
        expectedResult: 'POST request to /current-location',
        uiState: 'Background operation',
        flutterFile: 'home/viewmodel/home_viewmodel.dart:510-525',
      },
    ],
    postconditions: [
      'Server has updated user location',
      'Request blocked for 60 second cooldown',
    ],
    successCriteria: [
      'Location sent successfully',
      'No duplicate requests within cooldown',
    ],
    relatedTestCases: ['TC-HOME-018'],
  },
  {
    id: 'UC-HOME-013',
    title: 'Handle Address Change and Reset Screens',
    priority: 'High',
    userType: 'End User',
    description: 'When user changes their delivery address, the home screens are reset to reload data for the new location.',
    preconditions: [
      'User is logged in',
      'User changed delivery address',
    ],
    steps: [
      {
        step: 1,
        action: 'System detects address change flag',
        expectedResult: 'isAddressChanged flag is true',
        uiState: 'Observer triggers rebuild',
        flutterFile: 'home/view/home_view.dart:161-171',
      },
      {
        step: 2,
        action: 'Delete existing HomeFeedViewModel to clear cached data',
        expectedResult: 'ViewModel is unregistered from GetX',
        uiState: 'No visible change',
        flutterFile: 'home/view/home_view.dart:162-165',
      },
      {
        step: 3,
        action: 'Reset home screens list with new keys',
        expectedResult: 'All screens get fresh instances',
        uiState: 'Screens reload with new address context',
        flutterFile: 'home/view/home_view.dart:139-152',
      },
    ],
    postconditions: [
      'All data refreshed for new address',
      'isAddressChanged flag reset to false',
    ],
    successCriteria: [
      'Restaurants show for new location',
      'No stale data displayed',
    ],
    relatedTestCases: ['TC-HOME-019'],
  },
  {
    id: 'UC-HOME-014',
    title: 'Handle App Resume from Background',
    priority: 'High',
    userType: 'End User',
    description: 'When app comes back to foreground, location permissions are rechecked and appropriate updates are made.',
    preconditions: [
      'App was in background',
      'App is now resuming',
    ],
    steps: [
      {
        step: 1,
        action: 'App lifecycle changes to resumed',
        expectedResult: 'didChangeAppLifecycleState triggered',
        uiState: 'App becoming visible',
        flutterFile: 'home/view/home_view.dart:65-100',
      },
      {
        step: 2,
        action: 'Check location permissions (once per resume cycle)',
        expectedResult: 'Permission status evaluated',
        uiState: 'May trigger permission dialog',
        flutterFile: 'home/view/home_view.dart:72-93',
      },
      {
        step: 3,
        action: 'Update current location if permissions granted',
        expectedResult: 'Location refreshed',
        uiState: 'Content may update based on location',
        flutterFile: 'home/view/home_view.dart:81-91',
      },
      {
        step: 4,
        action: 'Check flash sale floating button visibility',
        expectedResult: 'Flash sale state updated',
        uiState: 'Floating button may appear/disappear',
        flutterFile: 'home/view/home_view.dart:95-97',
      },
    ],
    postconditions: [
      'App is in sync with current state',
      'Location is current',
    ],
    successCriteria: [
      'No infinite permission request loops',
      'Smooth resume experience',
    ],
    relatedTestCases: ['TC-HOME-020'],
  },
];


