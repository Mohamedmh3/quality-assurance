import type { EdgeCase } from '../types';

export const searchPageEdgeCases: EdgeCase[] = [
  {
    id: 'EC-SEARCH-001',
    title: 'Search Page Fails to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Critical',
    triggerCondition: 'fetchSections API call fails (network error, timeout, or server error)',
    expectedBehavior: 'App displays error message. Search page may show empty state. User can retry.',
    uiHandling: {
      errorMessage: 'Error message from exception or "Unable to load search page"',
      recoveryOptions: [
        'User can navigate back and try again',
        'User can pull to refresh',
        'User checks internet connection',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:fetchSections()', 'search_viewmodel.dart:init()'],
      validationRules: ['Error caught in try-catch, message shown via showMessage'],
      apiErrorCodes: ['Network errors, 500, timeout'],
    },
    relatedTestCases: ['TC-SEARCH-001'],
  },
  {
    id: 'EC-SEARCH-002',
    title: 'Search Tabs Fail to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'fetchSections API call fails or returns empty list',
    expectedBehavior: 'Tabs section hidden or shows error. Default sections may still load.',
    uiHandling: {
      errorMessage: 'Error message shown, tabs section may be hidden',
      recoveryOptions: [
        'User can still use search input',
        'User can retry by navigating back',
        'User checks internet connection',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:fetchSections()'],
      validationRules: ['Error handled, searchTabList may be empty'],
    },
    relatedTestCases: ['TC-SEARCH-001', 'TC-SEARCH-002'],
  },
  {
    id: 'EC-SEARCH-003',
    title: 'Search Sections Fail to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'searchSection API call fails for selected tab',
    expectedBehavior: 'Sections not displayed or show error. Search input still functional.',
    uiHandling: {
      errorMessage: 'Error message shown, sections may be hidden',
      recoveryOptions: [
        'User can still type and search',
        'User can switch tabs to retry',
        'User checks internet connection',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:searchSection()'],
      validationRules: ['Error handled, mainSearchSectionModel may be empty'],
    },
    relatedTestCases: ['TC-SEARCH-002', 'TC-SEARCH-009'],
  },
  {
    id: 'EC-SEARCH-004',
    title: 'Search API Returns Empty Results',
    category: 'Data',
    likelihood: 'High',
    impact: 'Medium',
    triggerCondition: 'fetchSearch API call succeeds but returns empty list',
    expectedBehavior: 'Empty state displayed. Message shows "No results found" or similar.',
    uiHandling: {
      errorMessage: 'Empty state message: "No restaurants found" or "Try different search"',
      recoveryOptions: [
        'User can modify search query',
        'User can clear filters',
        'User can try different keywords',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:fetchSearch()', 'search_list_result_widget.dart'],
      validationRules: ['Empty list handled, empty state widget shown'],
    },
    relatedTestCases: ['TC-SEARCH-003'],
  },
  {
    id: 'EC-SEARCH-005',
    title: 'Search API Fails During Search',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'fetchSearch API call fails (network error, timeout, or server error)',
    expectedBehavior: 'Error message displayed. Previous results may remain or empty state shown.',
    uiHandling: {
      errorMessage: 'Error message from exception or "Search failed. Please try again."',
      recoveryOptions: [
        'User can retry search',
        'User can check internet connection',
        'User can modify search query',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:fetchSearch()', 'search_viewmodel.dart:fetchSearchResult()'],
      validationRules: ['Error caught in try-catch, message shown via showMessage'],
      apiErrorCodes: ['Network errors, 500, timeout'],
    },
    relatedTestCases: ['TC-SEARCH-003'],
  },
  {
    id: 'EC-SEARCH-006',
    title: 'Search Suggestions API Fails',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'fetchSearchSuggest API call fails',
    expectedBehavior: 'Suggestions not displayed. Search input still functional. User can still search.',
    uiHandling: {
      errorMessage: 'No error message shown, suggestions simply not displayed',
      recoveryOptions: [
        'User can still type and search',
        'Suggestions are optional, no action needed',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:fetchSearchSuggest()', 'search_viewmodel.dart:fetchSearchSuggestList()'],
      validationRules: ['Error handled silently, suggestions list may be empty'],
    },
    relatedTestCases: ['TC-SEARCH-004'],
  },
  {
    id: 'EC-SEARCH-007',
    title: 'Filter API Fails to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'High',
    triggerCondition: 'Filter options fail to load when opening filter bottom sheet',
    expectedBehavior: 'Filter bottom sheet shows error or empty state. User can close and retry.',
    uiHandling: {
      errorMessage: 'Error message shown in bottom sheet or "Filters unavailable"',
      recoveryOptions: [
        'User can close bottom sheet',
        'User can retry opening filters',
        'User can search without filters',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:changeSelectedFilter()'],
      validationRules: ['Error handled, filter list may be empty'],
    },
    relatedTestCases: ['TC-SEARCH-005', 'TC-SEARCH-006'],
  },
  {
    id: 'EC-SEARCH-008',
    title: 'Multiple Filters Applied But No Results',
    category: 'Data',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'User applies multiple filters that result in no matching restaurants',
    expectedBehavior: 'Empty state displayed. Message suggests removing filters or trying different search.',
    uiHandling: {
      errorMessage: 'Empty state: "No restaurants match your filters. Try removing some filters."',
      recoveryOptions: [
        'User can remove individual filters',
        'User can clear all filters',
        'User can modify search query',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:requestSearch()', 'search_list_result_widget.dart'],
      validationRules: ['Empty results handled, empty state with filter removal suggestion'],
    },
    relatedTestCases: ['TC-SEARCH-006'],
  },
  {
    id: 'EC-SEARCH-009',
    title: 'Clear Filters Fails',
    category: 'State',
    likelihood: 'Low',
    impact: 'Medium',
    triggerCondition: 'Clear filters action fails to reset filter state or refresh results',
    expectedBehavior: 'Filters remain applied or error shown. User can manually remove filters.',
    uiHandling: {
      errorMessage: 'Error message or filters remain visible',
      recoveryOptions: [
        'User can manually remove each filter',
        'User can navigate back and return',
        'User can restart search',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:changeSelectedFilter()'],
      validationRules: ['Clear action should reset choosedFilter and subChosenFilter'],
    },
    relatedTestCases: ['TC-SEARCH-007'],
  },
  {
    id: 'EC-SEARCH-010',
    title: 'Categories Section Fails to Load',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'fetchCategories API call fails',
    expectedBehavior: 'Categories section hidden or shows error. Other sections still functional.',
    uiHandling: {
      errorMessage: 'Error message shown, categories section may be hidden',
      recoveryOptions: [
        'User can still search',
        'User can browse other sections',
        'User can retry by switching tabs',
      ],
    },
    implementationNotes: {
      flutterFiles: ['category_service.dart:fetchCategories()', 'categories_view_model.dart'],
      validationRules: ['Error handled, categories list may be empty'],
    },
    relatedTestCases: ['TC-SEARCH-009'],
  },
  {
    id: 'EC-SEARCH-011',
    title: 'Pagination Fails to Load More Results',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Medium',
    triggerCondition: 'fetchSearch API call fails when loading more results (pagination)',
    expectedBehavior: 'Error message shown. Previous results remain. User can retry scrolling.',
    uiHandling: {
      errorMessage: 'Error message: "Failed to load more results" or similar',
      recoveryOptions: [
        'User can scroll up and down to retry',
        'User can pull to refresh',
        'User can modify search query',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:fetchSearchResult()'],
      validationRules: ['Pagination error handled, loading state reset'],
    },
    relatedTestCases: ['TC-SEARCH-010'],
  },
  {
    id: 'EC-SEARCH-012',
    title: 'Item Search Returns No Results',
    category: 'Data',
    likelihood: 'High',
    impact: 'Medium',
    triggerCondition: 'searchItems API call succeeds but returns empty list',
    expectedBehavior: 'Empty state displayed. Message suggests trying different item name or restaurant.',
    uiHandling: {
      errorMessage: 'Empty state: "No items found. Try searching for a different dish."',
      recoveryOptions: [
        'User can modify search query',
        'User can search for restaurants instead',
        'User can browse categories',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:searchItems()'],
      validationRules: ['Empty list handled, empty state widget shown'],
    },
    relatedTestCases: ['TC-SEARCH-011'],
  },
  {
    id: 'EC-SEARCH-013',
    title: 'Recommend Outlet Submission Fails',
    category: 'Network',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'recommendOutlet API call fails',
    expectedBehavior: 'Error message displayed. Form remains open. User can retry submission.',
    uiHandling: {
      errorMessage: 'Error message: "Failed to submit recommendation. Please try again."',
      recoveryOptions: [
        'User can retry submission',
        'User can check internet connection',
        'User can close form and try later',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_service.dart:recommendOutlet()', 'user_suggest_viewmodel.dart:userRecommend()'],
      validationRules: ['Error caught, message shown, form remains open'],
    },
    relatedTestCases: ['TC-SEARCH-013'],
  },
  {
    id: 'EC-SEARCH-014',
    title: 'Search Results Do Not Update After Address Change',
    category: 'State',
    likelihood: 'Low',
    impact: 'High',
    triggerCondition: 'Address changes but search results do not refresh automatically',
    expectedBehavior: 'Results remain for old address. User should manually refresh or re-search.',
    uiHandling: {
      errorMessage: 'Results may show wrong delivery times or unavailable restaurants',
      recoveryOptions: [
        'User can pull to refresh',
        'User can modify search query',
        'User can navigate back and return',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:forceSearchRefresh()'],
      validationRules: ['Address change listener should trigger forceSearchRefresh'],
    },
    relatedTestCases: ['TC-SEARCH-014'],
  },
  {
    id: 'EC-SEARCH-015',
    title: 'Search Query Too Short',
    category: 'Validation',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User types search query with only 1 character',
    expectedBehavior: 'Search not executed. Suggestions may not appear. User continues typing.',
    uiHandling: {
      errorMessage: 'No error shown, search simply not executed until more characters typed',
      recoveryOptions: [
        'User continues typing',
        'User can browse sections instead',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:fetchSearchSuggestList()'],
      validationRules: ['Query length checked, search skipped if length <= 1'],
    },
    relatedTestCases: ['TC-SEARCH-003', 'TC-SEARCH-004'],
  },
  {
    id: 'EC-SEARCH-016',
    title: 'Search Query Too Long',
    category: 'Validation',
    likelihood: 'Low',
    impact: 'Low',
    triggerCondition: 'User types very long search query (e.g., 200+ characters)',
    expectedBehavior: 'Search executes but may be slow. Results may be limited or empty.',
    uiHandling: {
      errorMessage: 'No error shown, search executes normally',
      recoveryOptions: [
        'User can shorten query',
        'User can try different keywords',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:requestSearch()'],
      validationRules: ['No length limit enforced, query sent as-is'],
    },
    relatedTestCases: ['TC-SEARCH-003'],
  },
  {
    id: 'EC-SEARCH-017',
    title: 'Rapid Tab Switching',
    category: 'Concurrency',
    likelihood: 'Medium',
    impact: 'Low',
    triggerCondition: 'User rapidly switches between search tabs multiple times',
    expectedBehavior: 'Tabs switch correctly. Loading states handled. No duplicate API calls.',
    uiHandling: {
      errorMessage: 'No error, tabs switch smoothly',
      recoveryOptions: [
        'User waits for current tab to load',
        'User can switch tabs normally',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:changeSelectedTabIndex()'],
      validationRules: ['Tab switching debounced or previous requests cancelled'],
    },
    relatedTestCases: ['TC-SEARCH-002'],
  },
  {
    id: 'EC-SEARCH-018',
    title: 'Search While Results Are Loading',
    category: 'Concurrency',
    likelihood: 'High',
    impact: 'Low',
    triggerCondition: 'User types new search query while previous search is still loading',
    expectedBehavior: 'Previous search cancelled. New search executes. No duplicate results.',
    uiHandling: {
      errorMessage: 'No error, new search takes priority',
      recoveryOptions: [
        'User waits for new results',
        'User can modify query again',
      ],
    },
    implementationNotes: {
      flutterFiles: ['search_viewmodel.dart:requestSearch()'],
      validationRules: ['Previous search cancelled, lastSearchQuerys checked to prevent duplicate'],
    },
    relatedTestCases: ['TC-SEARCH-003'],
  },
];

