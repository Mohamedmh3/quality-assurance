import type { UseCase } from '../types';

export const orderTrackingUseCases: UseCase[] = [
  {
    id: 'UC-ORDER-TRACK-001',
    title: 'Load Order Tracking Screen',
    priority: 'Critical',
    userType: 'End User',
    description: 'When a customer opens the order tracking screen, the app loads order details and tracking steps, then displays them on a map with a bottom sheet overlay.',
    preconditions: [
      'User has placed an order',
      'User has a valid order ID',
      'User is logged into the app',
    ],
    steps: [
      {
        step: 1,
        action: 'App fetches order details and tracking steps in parallel',
        expectedResult: 'Both API calls complete successfully',
        uiState: 'Loading spinner displayed',
        flutterFile: 'order_tracking_viewmodel.dart:61-68',
      },
      {
        step: 2,
        action: 'App combines order info and tracking data into OrderTrackingResources',
        expectedResult: 'Resources object created with order and tracking data',
        uiState: 'Data loaded successfully',
        flutterFile: 'order_tracking_viewmodel.dart:132-139',
      },
      {
        step: 3,
        action: 'App initializes WebSocket connections for real-time updates',
        expectedResult: 'Order status socket and driver location socket connected',
        uiState: 'Real-time updates enabled',
        flutterFile: 'order_tracking_viewmodel.dart:144-148',
      },
      {
        step: 4,
        action: 'App fetches route between restaurant and customer',
        expectedResult: 'Route polyline drawn on map',
        uiState: 'Map shows route line',
        flutterFile: 'order_tracking_viewmodel.dart:154-193',
      },
    ],
    postconditions: [
      'Order tracking screen displays with map and bottom sheet',
      'Order status shows current step',
      'Map shows restaurant and customer markers',
      'WebSocket connections established for real-time updates',
    ],
    successCriteria: [
      'Order details load without errors',
      'Tracking steps display correctly',
      'Map initializes with correct markers',
      'Bottom sheet shows order information',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-001', 'TC-ORDER-TRACK-002', 'TC-ORDER-TRACK-003'],
  },
  {
    id: 'UC-ORDER-TRACK-002',
    title: 'Receive Real-Time Order Status Updates',
    priority: 'Critical',
    userType: 'End User',
    description: 'When order status changes on the server, the app receives updates via WebSocket and updates the UI to show the new status.',
    preconditions: [
      'Order tracking screen is open',
      'Order status WebSocket is connected',
      'Order status changes on server',
    ],
    steps: [
      {
        step: 1,
        action: 'WebSocket receives OrderStatusUpdate event',
        expectedResult: 'Update contains new status, message, lottie animation, and ETA',
        uiState: 'Status update received',
        flutterFile: 'order_tracking_viewmodel.dart:355-400',
      },
      {
        step: 2,
        action: 'App updates OrderTrackingModel with new data',
        expectedResult: 'Tracking model updated with new status, message, and driver info',
        uiState: 'Status step indicator updates',
        flutterFile: 'order_tracking_viewmodel.dart:373-390',
      },
      {
        step: 3,
        action: 'App emits new state with updated resources',
        expectedResult: 'UI rebuilds with new order status',
        uiState: 'Status message and step indicator change',
        flutterFile: 'order_tracking_viewmodel.dart:398-400',
      },
      {
        step: 4,
        action: 'If order reaches delivery stage, app initializes driver location socket',
        expectedResult: 'Driver location tracking begins',
        uiState: 'Driver marker appears on map',
        flutterFile: 'order_tracking_viewmodel.dart:402-413',
      },
    ],
    postconditions: [
      'Order status UI updated to reflect new status',
      'Status message displays new text',
      'Step indicator shows progress',
      'Driver location tracking active if in delivery stage',
    ],
    successCriteria: [
      'Status updates appear immediately without page refresh',
      'Status message is accurate',
      'Step indicator shows correct progress',
      'Driver location updates if applicable',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-004', 'TC-ORDER-TRACK-005', 'TC-ORDER-TRACK-006'],
  },
  {
    id: 'UC-ORDER-TRACK-003',
    title: 'Track Driver Location in Real-Time',
    priority: 'High',
    userType: 'End User',
    description: 'When order is out for delivery, the app receives driver location updates via Socket.IO and displays the driver position on the map.',
    preconditions: [
      'Order status is at or beyond outForDeliveryStep',
      'Driver is assigned to the order',
      'Driver location socket is connected',
    ],
    steps: [
      {
        step: 1,
        action: 'App initializes driver location socket when order reaches delivery stage',
        expectedResult: 'Socket.IO connection established with driver ID',
        uiState: 'Driver location tracking begins',
        flutterFile: 'order_tracking_viewmodel.dart:298-352',
      },
      {
        step: 2,
        action: 'App loads driver icon from assets',
        expectedResult: 'Driver pin icon ready for map marker',
        uiState: 'Icon loaded',
        flutterFile: 'order_tracking_viewmodel.dart:307-312',
      },
      {
        step: 3,
        action: 'Socket.IO receives driver location update (LatLng)',
        expectedResult: 'New driver position received',
        uiState: 'Location update received',
        flutterFile: 'order_tracking_viewmodel.dart:417-420',
      },
      {
        step: 4,
        action: 'App updates driver marker on map',
        expectedResult: 'Driver marker moves to new position',
        uiState: 'Driver marker animates to new location',
        flutterFile: 'order_tracking_viewmodel.dart:423-453',
      },
    ],
    postconditions: [
      'Driver marker visible on map',
      'Driver location updates in real-time',
      'Map shows driver position relative to restaurant and customer',
    ],
    successCriteria: [
      'Driver marker appears when order is out for delivery',
      'Driver location updates smoothly',
      'Marker uses custom driver icon',
      'Map shows all three locations (restaurant, customer, driver)',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-007', 'TC-ORDER-TRACK-008', 'TC-ORDER-TRACK-009'],
  },
  {
    id: 'UC-ORDER-TRACK-004',
    title: 'Display Order Status Progress',
    priority: 'High',
    userType: 'End User',
    description: 'The app displays a horizontal progress indicator showing all order status steps, with the current step highlighted.',
    preconditions: [
      'Order tracking data loaded',
      'Order has status steps defined',
    ],
    steps: [
      {
        step: 1,
        action: 'App reads order status steps from OrderTrackingModel',
        expectedResult: 'List of status steps available',
        uiState: 'Steps data ready',
        flutterFile: 'order_status_section.dart:17-34',
      },
      {
        step: 2,
        action: 'App finds current step index by matching currentStatus with step IDs',
        expectedResult: 'Current step index identified',
        uiState: 'Current step determined',
        flutterFile: 'order_status_section.dart:32-34',
      },
      {
        step: 3,
        action: 'App renders horizontal status indicator with icons and connecting lines',
        expectedResult: 'Status steps displayed horizontally',
        uiState: 'Progress indicator visible',
        flutterFile: 'order_status_section.dart:56-123',
      },
      {
        step: 4,
        action: 'App highlights completed steps, active step, and pending steps',
        expectedResult: 'Visual distinction between step states',
        uiState: 'Steps show correct colors and icons',
        flutterFile: 'order_status_section.dart:64-66',
      },
    ],
    postconditions: [
      'Order status progress indicator displayed',
      'Current step highlighted',
      'Completed steps shown with primary color',
      'Pending steps shown in grey',
    ],
    successCriteria: [
      'All order steps visible',
      'Current step clearly indicated',
      'Progress visually clear',
      'Icons display correctly',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-010', 'TC-ORDER-TRACK-011'],
  },
  {
    id: 'UC-ORDER-TRACK-005',
    title: 'Change Delivery Address',
    priority: 'Medium',
    userType: 'End User',
    description: 'When allowed, customer can change the delivery address for an active order.',
    preconditions: [
      'Order tracking screen is open',
      'Order allows address changes (canBeChangedAddress is true)',
      'User has multiple saved addresses',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps "Change Address" button',
        expectedResult: 'Address selection bottom sheet opens',
        uiState: 'Bottom sheet slides up',
        flutterFile: 'delivery_address_section.dart:114-206',
      },
      {
        step: 2,
        action: 'User selects a new address',
        expectedResult: 'New address selected',
        uiState: 'Confirmation dialog appears',
        flutterFile: 'delivery_address_section.dart:134-196',
      },
      {
        step: 3,
        action: 'User confirms address change',
        expectedResult: 'App calls updateOrderAddress API',
        uiState: 'Loading indicator shows',
        flutterFile: 'order_tracking_viewmodel.dart:195-242',
      },
      {
        step: 4,
        action: 'App updates order with new address',
        expectedResult: 'Order address updated successfully',
        uiState: 'Success message displayed',
        flutterFile: 'order_tracking_viewmodel.dart:210-229',
      },
    ],
    postconditions: [
      'Order delivery address updated',
      'New address displayed in UI',
      'Order continues with new address',
    ],
    successCriteria: [
      'Address change completes successfully',
      'New address displays correctly',
      'Success message shown',
      'Order continues tracking',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-012', 'TC-ORDER-TRACK-013', 'TC-ORDER-TRACK-014'],
  },
  {
    id: 'UC-ORDER-TRACK-006',
    title: 'Call Driver',
    priority: 'Medium',
    userType: 'End User',
    description: 'Customer can call the driver directly from the order tracking screen.',
    preconditions: [
      'Driver is assigned to the order',
      'Driver phone number is available',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps "Call" button in driver info section',
        expectedResult: 'Phone dialer opens with driver number',
        uiState: 'Phone app launches',
        flutterFile: 'driver_info_section.dart:84-86',
      },
      {
        step: 2,
        action: 'App formats phone number and creates tel: URI',
        expectedResult: 'Phone number formatted correctly',
        uiState: 'Number ready to dial',
        flutterFile: 'driver_info_section.dart:118-123',
      },
    ],
    postconditions: [
      'Phone dialer opens with driver number',
      'User can initiate call',
    ],
    successCriteria: [
      'Call button works',
      'Phone number formatted correctly',
      'Phone app opens successfully',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-015'],
  },
  {
    id: 'UC-ORDER-TRACK-007',
    title: 'Recenter Map View',
    priority: 'Low',
    userType: 'End User',
    description: 'User can recenter the map to fit all markers (restaurant, customer, driver) in view.',
    preconditions: [
      'Map is displayed',
      'Markers are on the map',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps recenter button',
        expectedResult: 'App calculates bounds for all markers',
        uiState: 'Bounds calculated',
        flutterFile: 'order_tracking_viewmodel.dart:493-520',
      },
      {
        step: 2,
        action: 'If driver marker exists, app excludes restaurant marker from bounds',
        expectedResult: 'Bounds focus on driver and customer',
        uiState: 'Bounds adjusted',
        flutterFile: 'order_tracking_viewmodel.dart:501-509',
      },
      {
        step: 3,
        action: 'App animates camera to fit bounds',
        expectedResult: 'Map zooms and pans to show all relevant markers',
        uiState: 'Map animates smoothly',
        flutterFile: 'order_tracking_viewmodel.dart:511-516',
      },
    ],
    postconditions: [
      'Map view shows all relevant markers',
      'Camera position updated',
      'Zoom level adjusted',
    ],
    successCriteria: [
      'Map recenters correctly',
      'All markers visible',
      'Animation smooth',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-016'],
  },
  {
    id: 'UC-ORDER-TRACK-008',
    title: 'Display Order Ended Overlay',
    priority: 'High',
    userType: 'End User',
    description: 'When order is completed, a full-screen overlay appears with completion animation and message.',
    preconditions: [
      'Order is completed (isOrderEnded is true)',
    ],
    steps: [
      {
        step: 1,
        action: 'App detects order is ended',
        expectedResult: 'isOrderEnded flag is true',
        uiState: 'Order completion detected',
        flutterFile: 'order_ended_overlay.dart:26-28',
      },
      {
        step: 2,
        action: 'App displays full-screen overlay with blur effect',
        expectedResult: 'Overlay covers entire screen',
        uiState: 'Blurred background visible',
        flutterFile: 'order_ended_overlay.dart:52-171',
      },
      {
        step: 3,
        action: 'App displays lottie animation',
        expectedResult: 'Completion animation plays',
        uiState: 'Animation visible',
        flutterFile: 'order_ended_overlay.dart:71-84',
      },
      {
        step: 4,
        action: 'App displays status message and order details',
        expectedResult: 'Completion message and order number shown',
        uiState: 'Text displayed',
        flutterFile: 'order_ended_overlay.dart:91-142',
      },
      {
        step: 5,
        action: 'App shows "Back to Home" button',
        expectedResult: 'Button visible',
        uiState: 'Button displayed',
        flutterFile: 'order_ended_overlay.dart:150-162',
      },
    ],
    postconditions: [
      'Order completion overlay displayed',
      'User cannot navigate back',
      'User can return to home',
    ],
    successCriteria: [
      'Overlay displays correctly',
      'Animation plays',
      'Message is clear',
      'Navigation works',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-017', 'TC-ORDER-TRACK-018'],
  },
  {
    id: 'UC-ORDER-TRACK-009',
    title: 'Delete Order',
    priority: 'Medium',
    userType: 'End User',
    description: 'When allowed, customer can delete an order from the tracking screen.',
    preconditions: [
      'Order can be deleted (canBeDeleted is true)',
      'Order tracking screen is open',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps "Delete Order" button',
        expectedResult: 'Delete confirmation dialog opens',
        uiState: 'Dialog appears',
        flutterFile: 'delete_order_button.dart:38-46',
      },
      {
        step: 2,
        action: 'User selects reason and confirms deletion',
        expectedResult: 'Order deleted successfully',
        uiState: 'Success message shown',
        flutterFile: 'delete_order_button.dart:40-45',
      },
      {
        step: 3,
        action: 'App navigates back or to home',
        expectedResult: 'User returned to previous screen or home',
        uiState: 'Navigation occurs',
        flutterFile: 'order_tracking_bottom_sheet.dart:156-165',
      },
    ],
    postconditions: [
      'Order deleted',
      'User navigated away from tracking screen',
    ],
    successCriteria: [
      'Delete button appears when allowed',
      'Deletion completes successfully',
      'Navigation works correctly',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-019', 'TC-ORDER-TRACK-020'],
  },
  {
    id: 'UC-ORDER-TRACK-010',
    title: 'Display Expected Delivery Time',
    priority: 'High',
    userType: 'End User',
    description: 'The app displays the expected delivery time in a prominent banner.',
    preconditions: [
      'Order tracking data loaded',
      'Expected time (ETA) is available',
    ],
    steps: [
      {
        step: 1,
        action: 'App reads ETA from OrderTrackingModel',
        expectedResult: 'ETA value available',
        uiState: 'Data ready',
        flutterFile: 'expected_time_section.dart:14-16',
      },
      {
        step: 2,
        action: 'App validates ETA is not null, empty, or "_"',
        expectedResult: 'ETA is valid',
        uiState: 'Validation passed',
        flutterFile: 'expected_time_section.dart:18-20',
      },
      {
        step: 3,
        action: 'App displays ETA in colored banner',
        expectedResult: 'Banner visible with expected time',
        uiState: 'Banner displayed',
        flutterFile: 'expected_time_section.dart:22-38',
      },
    ],
    postconditions: [
      'Expected delivery time displayed',
      'Banner visible in bottom sheet',
    ],
    successCriteria: [
      'ETA displays correctly',
      'Banner is prominent',
      'Format is clear',
    ],
    relatedTestCases: ['TC-ORDER-TRACK-021'],
  },
];



