import type { UseCase } from '../types';

export const otpUseCases: UseCase[] = [
  {
    id: 'UC-OTP-001',
    title: 'Open OTP Verification Screen',
    priority: 'Critical',
    userType: 'End User',
    description: 'After entering phone number, user is shown OTP verification screen to enter the 6-digit code received via SMS.',
    preconditions: [
      'User has entered phone number',
      'OTP code has been sent to phone',
      'User is on OTP verification screen',
    ],
    steps: [
      {
        step: 1,
        action: 'App navigates to OTP screen',
        expectedResult: 'OTP screen displays',
        uiState: 'OTP input field, phone number display, and resend option shown',
        flutterFile: 'otp_screen.dart:60-110',
      },
      {
        step: 2,
        action: 'App initializes OTP timer if enabled',
        expectedResult: 'Countdown timer starts (20 seconds)',
        uiState: 'Timer displays remaining seconds',
        flutterFile: 'otp_viewmodel.dart:43-49',
      },
      {
        step: 3,
        action: 'App enables SMS autofill listener',
        expectedResult: 'SMS autofill ready to capture code',
        uiState: 'Ready to auto-fill code from SMS',
        flutterFile: 'otp_screen.dart:36-56',
      },
    ],
    postconditions: [
      'OTP screen is displayed',
      '6-digit input field is ready',
      'Phone number is shown',
      'Resend option available',
      'Timer running if enabled',
    ],
    successCriteria: [
      'Screen loads without errors',
      'Input field is accessible',
      'Phone number displayed correctly',
      'SMS autofill enabled',
    ],
    relatedTestCases: ['TC-OTP-001', 'TC-OTP-002'],
  },
  {
    id: 'UC-OTP-002',
    title: 'Enter OTP Code Manually',
    priority: 'Critical',
    userType: 'End User',
    description: 'User manually enters the 6-digit OTP code received via SMS.',
    preconditions: [
      'OTP screen is open',
      'User has received SMS with code',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps on OTP input field',
        expectedResult: 'First digit field focused',
        uiState: 'Cursor appears in first digit field',
        flutterFile: 'otp_text_form_widget.dart:52-73',
      },
      {
        step: 2,
        action: 'User types 6-digit code',
        expectedResult: 'Code entered digit by digit',
        uiState: 'Each digit appears in respective field as user types',
        flutterFile: 'otp_text_form_widget.dart:69',
      },
      {
        step: 3,
        action: 'App updates OTP state as user types',
        expectedResult: 'State updated with entered code',
        uiState: 'Code stored in state',
        flutterFile: 'otp_viewmodel.dart:29-34',
      },
      {
        step: 4,
        action: 'When 6 digits entered, app auto-verifies',
        expectedResult: 'Verification triggered automatically',
        uiState: 'Loading state, verification API called',
        flutterFile: 'otp_screen.dart:186-194',
      },
    ],
    postconditions: [
      '6-digit code entered',
      'Code stored in state',
      'Verification triggered',
      'Loading state active',
    ],
    successCriteria: [
      'Input accepts digits',
      'Code updates correctly',
      'Auto-verification works',
      'Loading state shown',
    ],
    relatedTestCases: ['TC-OTP-003', 'TC-OTP-004'],
  },
  {
    id: 'UC-OTP-003',
    title: 'Auto-Fill OTP from SMS',
    priority: 'High',
    userType: 'End User',
    description: 'User receives SMS with OTP code, and app automatically fills the code using SMS autofill.',
    preconditions: [
      'OTP screen is open',
      'SMS autofill is enabled',
      'User receives SMS with OTP',
    ],
    steps: [
      {
        step: 1,
        action: 'App listens for SMS with OTP code',
        expectedResult: 'SMS listener active',
        uiState: 'Ready to capture SMS',
        flutterFile: 'otp_screen.dart:38-41',
      },
      {
        step: 2,
        action: 'User receives SMS with OTP code',
        expectedResult: 'SMS received',
        uiState: 'SMS notification appears',
        flutterFile: 'otp_screen.dart:40',
      },
      {
        step: 3,
        action: 'App extracts code from SMS',
        expectedResult: 'Code extracted',
        uiState: 'Code detected from SMS',
        flutterFile: 'otp_screen.dart:49-56',
      },
      {
        step: 4,
        action: 'App auto-fills code in input field',
        expectedResult: 'Code filled automatically',
        uiState: 'All 6 digits filled in input fields',
        flutterFile: 'otp_screen.dart:52-54',
      },
      {
        step: 5,
        action: 'App triggers verification automatically',
        expectedResult: 'Verification starts',
        uiState: 'Loading state, API call initiated',
        flutterFile: 'otp_viewmodel.dart:29-34',
      },
    ],
    postconditions: [
      'Code auto-filled',
      'Verification triggered',
      'Loading state active',
    ],
    successCriteria: [
      'SMS autofill works',
      'Code extracted correctly',
      'Auto-fill works',
      'Verification triggered',
    ],
    relatedTestCases: ['TC-OTP-005', 'TC-OTP-006'],
  },
  {
    id: 'UC-OTP-004',
    title: 'Verify OTP Code',
    priority: 'Critical',
    userType: 'End User',
    description: 'User enters valid OTP code, app verifies it with backend, and navigates to next screen on success.',
    preconditions: [
      'OTP screen is open',
      'Valid 6-digit code entered',
    ],
    steps: [
      {
        step: 1,
        action: 'User enters 6-digit code',
        expectedResult: 'Code entered',
        uiState: 'All 6 digits filled',
        flutterFile: 'otp_screen.dart:183-195',
      },
      {
        step: 2,
        action: 'App triggers verification API call',
        expectedResult: 'API request sent',
        uiState: 'Loading indicator shown',
        flutterFile: 'otp_viewmodel.dart:95-106',
      },
      {
        step: 3,
        action: 'Backend validates OTP code',
        expectedResult: 'Code validated',
        uiState: 'API response received',
        flutterFile: 'otp_viewmodel.dart:97',
      },
      {
        step: 4,
        action: 'App receives success response',
        expectedResult: 'Verification successful',
        uiState: 'Success state set',
        flutterFile: 'otp_viewmodel.dart:102-104',
      },
      {
        step: 5,
        action: 'App navigates to next screen',
        expectedResult: 'Navigation to user info screen',
        uiState: 'Screen transitions',
        flutterFile: 'otp_screen.dart:74-79',
      },
    ],
    postconditions: [
      'OTP verified successfully',
      'User authenticated',
      'Navigation to next screen',
      'Phone number verified',
    ],
    successCriteria: [
      'Verification succeeds',
      'Navigation occurs',
      'User state updated',
      'No errors',
    ],
    relatedTestCases: ['TC-OTP-007', 'TC-OTP-008'],
  },
  {
    id: 'UC-OTP-005',
    title: 'Resend OTP via SMS',
    priority: 'High',
    userType: 'End User',
    description: 'User can resend OTP code via SMS if they did not receive it or it expired.',
    preconditions: [
      'OTP screen is open',
      'Timer has expired or user wants to resend',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps Resend Code',
        expectedResult: 'Resend bottom sheet opens',
        uiState: 'Bottom sheet slides up with resend options',
        flutterFile: 'otp_screen.dart:217-239',
      },
      {
        step: 2,
        action: 'User selects Resend via SMS',
        expectedResult: 'SMS resend triggered',
        uiState: 'Loading state, API call initiated',
        flutterFile: 'resend_code_bottom_sheet.dart:45-53',
      },
      {
        step: 3,
        action: 'App sends resend OTP request',
        expectedResult: 'New OTP sent',
        uiState: 'Loading indicator shown',
        flutterFile: 'otp_viewmodel.dart:108-129',
      },
      {
        step: 4,
        action: 'App starts countdown timer',
        expectedResult: '20-second timer starts',
        uiState: 'Timer displays countdown',
        flutterFile: 'otp_viewmodel.dart:120',
      },
      {
        step: 5,
        action: 'User receives new SMS',
        expectedResult: 'New OTP code received',
        uiState: 'SMS notification with new code',
        flutterFile: 'otp_viewmodel.dart:119-127',
      },
    ],
    postconditions: [
      'New OTP sent',
      'Timer started',
      'User can enter new code',
      'Resend disabled during timer',
    ],
    successCriteria: [
      'Resend works',
      'New code sent',
      'Timer starts',
      'User receives SMS',
    ],
    relatedTestCases: ['TC-OTP-009', 'TC-OTP-010'],
  },
  {
    id: 'UC-OTP-006',
    title: 'Resend OTP via Phone Call',
    priority: 'High',
    userType: 'End User',
    description: 'User can request OTP code via phone call instead of SMS.',
    preconditions: [
      'OTP screen is open',
      'User wants phone call instead of SMS',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps Resend Code',
        expectedResult: 'Resend bottom sheet opens',
        uiState: 'Bottom sheet with SMS and Call options',
        flutterFile: 'otp_screen.dart:217-239',
      },
      {
        step: 2,
        action: 'User selects Resend via Phone Call',
        expectedResult: 'Phone call resend triggered',
        uiState: 'Loading state, API call initiated',
        flutterFile: 'resend_code_bottom_sheet.dart:56-64',
      },
      {
        step: 3,
        action: 'App sends resend OTP via call request',
        expectedResult: 'OTP call initiated',
        uiState: 'Loading indicator shown',
        flutterFile: 'otp_viewmodel.dart:108-129',
      },
      {
        step: 4,
        action: 'User receives phone call with code',
        expectedResult: 'Automated call with OTP code',
        uiState: 'Phone call received',
        flutterFile: 'otp_viewmodel.dart:120',
      },
      {
        step: 5,
        action: 'App starts countdown timer',
        expectedResult: '20-second timer starts',
        uiState: 'Timer displays countdown',
        flutterFile: 'otp_viewmodel.dart:120',
      },
    ],
    postconditions: [
      'OTP call initiated',
      'Timer started',
      'User receives call',
      'Resend disabled during timer',
    ],
    successCriteria: [
      'Phone call option works',
      'Call initiated',
      'Timer starts',
      'User receives call',
    ],
    relatedTestCases: ['TC-OTP-011', 'TC-OTP-012'],
  },
  {
    id: 'UC-OTP-007',
    title: 'Handle Invalid OTP Code',
    priority: 'High',
    userType: 'End User',
    description: 'When user enters invalid OTP code, app displays error message and allows retry.',
    preconditions: [
      'OTP screen is open',
      'User enters invalid code',
    ],
    steps: [
      {
        step: 1,
        action: 'User enters invalid OTP code',
        expectedResult: 'Invalid code entered',
        uiState: '6 digits entered',
        flutterFile: 'otp_screen.dart:186-194',
      },
      {
        step: 2,
        action: 'App sends verification request',
        expectedResult: 'API call made',
        uiState: 'Loading indicator shown',
        flutterFile: 'otp_viewmodel.dart:95-106',
      },
      {
        step: 3,
        action: 'Backend returns error',
        expectedResult: 'Invalid code error',
        uiState: 'Error response received',
        flutterFile: 'otp_viewmodel.dart:98-100',
      },
      {
        step: 4,
        action: 'App displays error message',
        expectedResult: 'Error dialog shown',
        uiState: 'Error message displayed',
        flutterFile: 'otp_screen.dart:82-92',
      },
      {
        step: 5,
        action: 'User can retry with correct code',
        expectedResult: 'Input field cleared or ready',
        uiState: 'User can enter new code',
        flutterFile: 'otp_screen.dart:183-195',
      },
    ],
    postconditions: [
      'Error message displayed',
      'User can retry',
      'Input field accessible',
      'No navigation occurs',
    ],
    successCriteria: [
      'Error handled gracefully',
      'Error message clear',
      'User can retry',
      'No app crash',
    ],
    relatedTestCases: ['TC-OTP-013', 'TC-OTP-014'],
  },
  {
    id: 'UC-OTP-008',
    title: 'Navigate Back from OTP Screen',
    priority: 'Medium',
    userType: 'End User',
    description: 'User can navigate back to phone number screen if they want to change phone number.',
    preconditions: [
      'OTP screen is open',
      'User wants to go back',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps back button',
        expectedResult: 'Back navigation triggered',
        uiState: 'Back button pressed',
        flutterFile: 'otp_screen.dart:138-144',
      },
      {
        step: 2,
        action: 'App navigates to phone number screen',
        expectedResult: 'Phone number screen displayed',
        uiState: 'Screen transitions back',
        flutterFile: 'otp_screen.dart:141-143',
      },
      {
        step: 3,
        action: 'App clears navigation stack',
        expectedResult: 'Stack cleared',
        uiState: 'Previous screen shown',
        flutterFile: 'otp_screen.dart:141-143',
      },
    ],
    postconditions: [
      'Back navigation occurs',
      'Phone number screen shown',
      'User can change phone number',
      'OTP screen removed from stack',
    ],
    successCriteria: [
      'Back navigation works',
      'Correct screen shown',
      'Stack cleared',
      'No errors',
    ],
    relatedTestCases: ['TC-OTP-015'],
  },
];

