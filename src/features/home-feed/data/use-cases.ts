import type { UseCase } from '@/lib/types';

export const homeFeedUseCases: UseCase[] = [
  {
    id: 'UC-HOMEFEED-001',
    title: 'Load Home Feed with Dynamic Sections',
    priority: 'Critical',
    userType: 'End User',
    description: 'When users open the home feed, the app loads a dynamic list of sections (banners, restaurants, dishes, offers, vouchers, orders) configured by the backend.',
    preconditions: [
      'User is logged in or guest',
      'Location permission granted or address selected',
      'Internet connection available',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchHomeItems() API with location coordinates',
        expectedResult: 'Backend returns list of HomeItemModel objects with section types and data URLs',
        uiState: 'Loading indicator shows while fetching',
        flutterFile: 'home_feed_view_page/service/feed_service.dart:39-61',
      },
      {
        step: 2,
        action: 'ViewModel processes home list and determines which sections to load',
        expectedResult: 'homeList is populated with section items',
        uiState: 'Initial sections start loading',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:626-641',
      },
      {
        step: 3,
        action: 'App loads data for each section type (restaurants, dishes, banners, etc.)',
        expectedResult: 'Each section fetches its specific data from provided URLs',
        uiState: 'Sections appear progressively as data loads',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:644-768',
      },
    ],
    postconditions: [
      'Home feed displays all configured sections',
      'Each section shows relevant content',
      'User can scroll through the feed',
    ],
    successCriteria: [
      'All sections load without errors',
      'Content displays correctly for each section type',
      'No duplicate sections appear',
    ],
    relatedTestCases: ['TC-HOMEFEED-001', 'TC-HOMEFEED-002'],
  },
  {
    id: 'UC-HOMEFEED-002',
    title: 'Pull to Refresh Home Feed',
    priority: 'High',
    userType: 'End User',
    description: 'Users can pull down on the home feed to refresh all content and get the latest data.',
    preconditions: [
      'User is on home feed screen',
      'Home feed is already loaded',
    ],
    steps: [
      {
        step: 1,
        action: 'User pulls down on the home feed',
        expectedResult: 'Refresh controller triggers onRefresh()',
        uiState: 'Pull-to-refresh indicator appears',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1132-1190',
      },
      {
        step: 2,
        action: 'App checks throttling - prevents refresh if too soon since last refresh',
        expectedResult: 'Refresh proceeds if enough time has passed, or after 5 retry attempts',
        uiState: 'Refresh indicator shows or dismisses',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1139-1163',
      },
      {
        step: 3,
        action: 'App calls getHomeData() to refresh all sections',
        expectedResult: 'All home feed data is refreshed (home list, rewards, tier info, latest orders)',
        uiState: 'Content updates with fresh data',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:285-312',
      },
    ],
    postconditions: [
      'Home feed shows latest content',
      'Refresh timestamp is updated',
      'Refresh counter resets',
    ],
    successCriteria: [
      'Refresh completes successfully',
      'All sections update with new data',
      'No duplicate content appears',
    ],
    relatedTestCases: ['TC-HOMEFEED-003', 'TC-HOMEFEED-004'],
  },
  {
    id: 'UC-HOMEFEED-003',
    title: 'Load More Sections with Pagination',
    priority: 'High',
    userType: 'End User',
    description: 'As users scroll down, the app automatically loads more sections from the home list using pagination.',
    preconditions: [
      'Home feed is loaded',
      'User has scrolled near the bottom',
      'More sections are available to load',
    ],
    steps: [
      {
        step: 1,
        action: 'User scrolls near bottom of feed',
        expectedResult: 'onLoading() is triggered',
        uiState: 'Loading footer appears at bottom',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1193-1204',
      },
      {
        step: 2,
        action: 'App finds next unloaded section in homeList',
        expectedResult: 'currentIndexHomeList is set to first unloaded section',
        uiState: 'Loading indicator shows',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:663-669',
      },
      {
        step: 3,
        action: 'App loads data for next batch of sections (default 3 sections)',
        expectedResult: 'Sections are fetched and added to display',
        uiState: 'New sections appear in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:680-768',
      },
    ],
    postconditions: [
      'More sections are visible in feed',
      'Pagination index is updated',
      'User can continue scrolling',
    ],
    successCriteria: [
      'Sections load without errors',
      'No duplicate sections',
      'Smooth scrolling experience',
    ],
    relatedTestCases: ['TC-HOMEFEED-005', 'TC-HOMEFEED-006'],
  },
  {
    id: 'UC-HOMEFEED-004',
    title: 'Display Latest Order Status Card',
    priority: 'Critical',
    userType: 'End User',
    description: 'Logged-in users see their latest active order(s) displayed as a card in the home feed with real-time status updates.',
    preconditions: [
      'User is logged in',
      'User has at least one active order',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchLatestOrder() API',
        expectedResult: 'Backend returns list of active orders',
        uiState: 'Order card section appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1266-1353',
      },
      {
        step: 2,
        action: 'App subscribes to WebSocket for order status updates',
        expectedResult: 'Real-time updates are received for order status changes',
        uiState: 'Order status updates automatically',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1528-1577',
      },
      {
        step: 3,
        action: 'Order card displays order details, timeline, and actions',
        expectedResult: 'User sees order status, restaurant info, ETA, and action buttons',
        uiState: 'Order card shows current status with visual timeline',
        flutterFile: 'home_feed_view_page/view/home_widgets/order_status_widget/latest_order_widget.dart:21-116',
      },
    ],
    postconditions: [
      'Latest order card is visible in feed',
      'Order status updates in real-time',
      'User can interact with order card',
    ],
    successCriteria: [
      'Order card displays correctly',
      'Status updates without page refresh',
      'All order information is accurate',
    ],
    relatedTestCases: ['TC-HOMEFEED-007', 'TC-HOMEFEED-008'],
  },
  {
    id: 'UC-HOMEFEED-005',
    title: 'Delete Order from Home Feed',
    priority: 'High',
    userType: 'End User',
    description: 'Users can delete an active order from the home feed, with a confirmation dialog and reason selection.',
    preconditions: [
      'User is logged in',
      'User has an active order displayed',
      'Order deletion is allowed',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps delete button on order card',
        expectedResult: 'Delete confirmation dialog appears',
        uiState: 'Bottom sheet shows warning and countdown timer',
        flutterFile: 'home_feed_view_page/view/home_widgets/order_status_widget/latest_order_widget.dart:118-223',
      },
      {
        step: 2,
        action: 'User holds delete button for 5 seconds',
        expectedResult: 'Timer counts down from 5 to 0',
        uiState: 'Countdown timer displays remaining seconds',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:495-503',
      },
      {
        step: 3,
        action: 'App calls deleteOrder() API',
        expectedResult: 'Backend processes deletion and returns delete reasons',
        uiState: 'Delete reason selection dialog appears',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:943-990',
      },
      {
        step: 4,
        action: 'User selects deletion reason and submits',
        expectedResult: 'Order is deleted and removed from feed',
        uiState: 'Order card disappears, success message shown',
        flutterFile: 'home_feed_view_page/service/feed_service.dart:544-572',
      },
    ],
    postconditions: [
      'Order is deleted from system',
      'Order card removed from home feed',
      'Latest order list is refreshed',
    ],
    successCriteria: [
      'Deletion completes successfully',
      'User cannot accidentally delete',
      'Reason is recorded for analytics',
    ],
    relatedTestCases: ['TC-HOMEFEED-009', 'TC-HOMEFEED-010'],
  },
  {
    id: 'UC-HOMEFEED-006',
    title: 'Switch Between Delivery and Pickup',
    priority: 'High',
    userType: 'End User',
    description: 'Users can toggle between delivery and pickup modes, which changes the content shown in the home feed.',
    preconditions: [
      'User is on home feed',
      'Both delivery and pickup options are available',
    ],
    steps: [
      {
        step: 1,
        action: 'User taps delivery/pickup toggle',
        expectedResult: 'currentPickUpState changes to selected mode',
        uiState: 'Toggle button updates to show selected mode',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1109-1124',
      },
      {
        step: 2,
        action: 'App checks if home list for selected mode is already loaded',
        expectedResult: 'If not loaded, fetches home list for that mode',
        uiState: 'Loading indicator shows if fetching',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:315-334',
      },
      {
        step: 3,
        action: 'App switches between deliveryHomeList and pickupHomeList',
        expectedResult: 'Home feed displays content appropriate for selected mode',
        uiState: 'Feed updates to show mode-specific content',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:172-184',
      },
    ],
    postconditions: [
      'Home feed shows content for selected mode',
      'Mode preference is saved',
      'User can switch back anytime',
    ],
    successCriteria: [
      'Mode switch completes smoothly',
      'Correct content displays for each mode',
      'No data mixing between modes',
    ],
    relatedTestCases: ['TC-HOMEFEED-011', 'TC-HOMEFEED-012'],
  },
  {
    id: 'UC-HOMEFEED-007',
    title: 'View and Interact with Flash Sale',
    priority: 'Medium',
    userType: 'End User',
    description: 'When a flash sale is active, users see a floating button and can open a bottom sheet to view flash sale items and copy voucher codes.',
    preconditions: [
      'Flash sale is enabled in settings',
      'Active flash sale exists',
      'User is logged in',
    ],
    steps: [
      {
        step: 1,
        action: 'App periodically checks for flash sale (every X seconds)',
        expectedResult: 'Flash sale data is fetched and validated',
        uiState: 'Floating button appears if flash sale is valid',
        flutterFile: 'home_feed_view_page/view/home_widgets/flash_sale/viewmodel/flash_sale_viewmodel.dart:91-130',
      },
      {
        step: 2,
        action: 'User taps flash sale floating button',
        expectedResult: 'Flash sale bottom sheet opens',
        uiState: 'Bottom sheet displays flash sale items (vouchers, restaurants, dishes)',
        flutterFile: 'home_feed_view_page/view/home_feed_view.dart:269-284',
      },
      {
        step: 3,
        action: 'User browses flash sale items and taps copy code',
        expectedResult: 'Voucher code is copied to clipboard',
        uiState: 'Copy confirmation shown, button state changes',
        flutterFile: 'home_feed_view_page/view/home_widgets/flash_sale/viewmodel/flash_sale_viewmodel.dart:29-30',
      },
    ],
    postconditions: [
      'Flash sale is displayed',
      'Voucher code is copied (if applicable)',
      'User can use code in checkout',
    ],
    successCriteria: [
      'Flash sale displays correctly',
      'Codes copy successfully',
      'Timer shows remaining time',
    ],
    relatedTestCases: ['TC-HOMEFEED-013', 'TC-HOMEFEED-014'],
  },
  {
    id: 'UC-HOMEFEED-008',
    title: 'View Vouchers Section',
    priority: 'High',
    userType: 'End User',
    description: 'Logged-in users see their available vouchers displayed in a dedicated section of the home feed.',
    preconditions: [
      'User is logged in',
      'User has vouchers available',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchRewards() to get user vouchers',
        expectedResult: 'Backend returns list of user vouchers grouped by category',
        uiState: 'Voucher section appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:605-623',
      },
      {
        step: 2,
        action: 'App displays voucher cards with details',
        expectedResult: 'Each voucher shows discount, expiry, terms',
        uiState: 'Voucher cards are visible in feed',
        flutterFile: 'home_feed_view_page/view/home_widgets/my_vouchers_section.dart',
      },
      {
        step: 3,
        action: 'User taps on a voucher card',
        expectedResult: 'Voucher details bottom sheet opens',
        uiState: 'Full voucher information displayed',
        flutterFile: 'home_feed_view_page/view/home_widgets/voucher_details_bottom_sheet.dart',
      },
    ],
    postconditions: [
      'Vouchers are displayed',
      'User can view voucher details',
      'Voucher count is accurate',
    ],
    successCriteria: [
      'All vouchers display correctly',
      'Expired vouchers are filtered',
      'Voucher details are accurate',
    ],
    relatedTestCases: ['TC-HOMEFEED-015', 'TC-HOMEFEED-016'],
  },
  {
    id: 'UC-HOMEFEED-009',
    title: 'View Loyalty Points and Tier Information',
    priority: 'Medium',
    userType: 'End User',
    description: 'Logged-in users can see their loyalty points balance and current tier level displayed in the home feed.',
    preconditions: [
      'User is logged in',
      'Loyalty program is enabled',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchTierInfo() API',
        expectedResult: 'Backend returns user points, tier level, and progress',
        uiState: 'Loyalty card displays in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:506-534',
      },
      {
        step: 2,
        action: 'App compares old points with new points',
        expectedResult: 'If points increased, celebration dialog shows',
        uiState: 'Points earned dialog appears with confetti',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:525-528',
      },
      {
        step: 3,
        action: 'User taps loyalty card',
        expectedResult: 'Navigates to full loyalty program page',
        uiState: 'Loyalty page opens showing rewards, achievements, history',
        flutterFile: 'home_feed_view_page/view/home_widgets/loyalty_card.dart',
      },
    ],
    postconditions: [
      'Loyalty information is displayed',
      'Points are updated',
      'User can access full loyalty features',
    ],
    successCriteria: [
      'Points display accurately',
      'Tier information is correct',
      'Points earned dialog shows when appropriate',
    ],
    relatedTestCases: ['TC-HOMEFEED-017', 'TC-HOMEFEED-018'],
  },
  {
    id: 'UC-HOMEFEED-010',
    title: 'View Achievements Carousel',
    priority: 'Medium',
    userType: 'End User',
    description: 'Users can see their available achievements (challenges) in a carousel widget and track progress.',
    preconditions: [
      'User is logged in',
      'Achievements are available',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchAchievementsList() API',
        expectedResult: 'Backend returns list of incomplete achievements',
        uiState: 'Achievement carousel appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1243-1263',
      },
      {
        step: 2,
        action: 'App filters out completed achievements',
        expectedResult: 'Only incomplete achievements are shown',
        uiState: 'Carousel displays available challenges',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1256',
      },
      {
        step: 3,
        action: 'User swipes through achievement cards',
        expectedResult: 'Carousel scrolls to show different achievements',
        uiState: 'Achievement cards show progress, points, description',
        flutterFile: 'home_feed_view_page/view/home_widgets/achivement_carousel.dart',
      },
    ],
    postconditions: [
      'Achievements are displayed',
      'User can see progress',
      'User can interact with achievements',
    ],
    successCriteria: [
      'All achievements display correctly',
      'Progress is accurate',
      'Carousel scrolls smoothly',
    ],
    relatedTestCases: ['TC-HOMEFEED-019'],
  },
  {
    id: 'UC-HOMEFEED-011',
    title: 'View Banners and Promotional Content',
    priority: 'Medium',
    userType: 'End User',
    description: 'Users see promotional banners at the top of the home feed that can be tapped to navigate to specific content.',
    preconditions: [
      'Banners are configured',
      'User is on home feed',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchBannerList() API',
        expectedResult: 'Backend returns list of banner images and links',
        uiState: 'Banner carousel appears at top of feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1424-1439',
      },
      {
        step: 2,
        action: 'Banners auto-scroll or user swipes',
        expectedResult: 'Different banners are displayed',
        uiState: 'Banner carousel shows different promotional content',
        flutterFile: 'home_feed_view_page/view/home_widgets/banner_widgets/home_feed_banner_widget.dart',
      },
      {
        step: 3,
        action: 'User taps on a banner',
        expectedResult: 'App navigates to linked content (restaurant, dish, offer)',
        uiState: 'Navigation occurs to target screen',
        flutterFile: 'home_feed_view_page/view/home_widgets/banner_widgets/home_banner_card_widget.dart',
      },
    ],
    postconditions: [
      'Banners are displayed',
      'User can interact with banners',
      'Navigation works correctly',
    ],
    successCriteria: [
      'Banners load and display correctly',
      'Carousel functions smoothly',
      'Links navigate to correct content',
    ],
    relatedTestCases: ['TC-HOMEFEED-020'],
  },
  {
    id: 'UC-HOMEFEED-012',
    title: 'View Offers and Promotions',
    priority: 'Medium',
    userType: 'End User',
    description: 'Users can see available offers (both old and new v2 format) displayed in sections of the home feed.',
    preconditions: [
      'Offers are available',
      'User is on home feed',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls getOffersListAll() or getOfferV2ListAll() API',
        expectedResult: 'Backend returns list of active offers',
        uiState: 'Offers section appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1356-1387',
      },
      {
        step: 2,
        action: 'App displays offers in horizontal scrollable list',
        expectedResult: 'Each offer shows image, text, voucher code, expiry',
        uiState: 'Offers are visible and scrollable',
        flutterFile: 'home_feed_view_page/view/home_widgets/offers_list.dart',
      },
      {
        step: 3,
        action: 'User taps on an offer',
        expectedResult: 'App navigates to restaurant or applies voucher',
        uiState: 'Navigation occurs or voucher is applied',
        flutterFile: 'home_feed_view_page/view/home_widgets/offerv2/offerv2_card.dart',
      },
    ],
    postconditions: [
      'Offers are displayed',
      'User can interact with offers',
      'Voucher codes can be used',
    ],
    successCriteria: [
      'All offers display correctly',
      'Expired offers are filtered',
      'Navigation works correctly',
    ],
    relatedTestCases: ['TC-HOMEFEED-021'],
  },
  {
    id: 'UC-HOMEFEED-013',
    title: 'View Onboarding Progress',
    priority: 'Low',
    userType: 'End User',
    description: 'New users see their onboarding progress and can complete steps to unlock rewards.',
    preconditions: [
      'User is logged in',
      'Onboarding progress feature is enabled',
      'User has incomplete onboarding steps',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls fetchOnboardingProgress() API',
        expectedResult: 'Backend returns current step and progress',
        uiState: 'Progress bar or card appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:537-564',
      },
      {
        step: 2,
        action: 'App compares local step with remote step',
        expectedResult: 'If remote step is different, bottom sheet shows',
        uiState: 'Onboarding progress bottom sheet appears',
        flutterFile: 'home_feed_view_page/view/home_feed_view.dart:67-78',
      },
      {
        step: 3,
        action: 'User taps on progress card or completes step',
        expectedResult: 'Progress updates and user can scroll to voucher section',
        uiState: 'Progress updates, feed scrolls to vouchers',
        flutterFile: 'home_feed_view_page/view/home_widgets/onboarding_progress_bar/onboarding_progress_bottom_sheet.dart',
      },
    ],
    postconditions: [
      'Onboarding progress is displayed',
      'User can complete steps',
      'Progress is saved',
    ],
    successCriteria: [
      'Progress displays accurately',
      'Steps can be completed',
      'Rewards unlock correctly',
    ],
    relatedTestCases: ['TC-HOMEFEED-022'],
  },
  {
    id: 'UC-HOMEFEED-014',
    title: 'Handle Push Notifications for Order Updates',
    priority: 'Critical',
    userType: 'End User',
    description: 'When order status changes, users receive push notifications and the home feed updates automatically.',
    preconditions: [
      'User is logged in',
      'User has active orders',
      'Notifications are enabled',
    ],
    steps: [
      {
        step: 1,
        action: 'Firebase receives push notification with order update',
        expectedResult: 'Notification data contains order ID and status',
        uiState: 'Notification appears in system tray',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:339-431',
      },
      {
        step: 2,
        action: 'App processes notification and calls fetchLatestOrder()',
        expectedResult: 'Latest order list is refreshed',
        uiState: 'Order card updates with new status',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:394-396',
      },
      {
        step: 3,
        action: 'WebSocket receives real-time update',
        expectedResult: 'Order status updates immediately without refresh',
        uiState: 'Order timeline and status update in real-time',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1579-1600',
      },
    ],
    postconditions: [
      'Order status is updated',
      'User is notified of changes',
      'Feed reflects latest status',
    ],
    successCriteria: [
      'Notifications are received',
      'Order updates correctly',
      'No duplicate updates',
    ],
    relatedTestCases: ['TC-HOMEFEED-023', 'TC-HOMEFEED-024'],
  },
  {
    id: 'UC-HOMEFEED-015',
    title: 'View New User Offers',
    priority: 'Medium',
    userType: 'End User',
    description: 'New users see special offers available only for first-time customers.',
    preconditions: [
      'User is logged in',
      'User is eligible for new user offers',
      'New user offers are available',
    ],
    steps: [
      {
        step: 1,
        action: 'App calls getNewUserOffers() API',
        expectedResult: 'Backend returns list of first-order offers',
        uiState: 'New user offers section appears in feed',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1390-1407',
      },
      {
        step: 2,
        action: 'If offers exist, banners are hidden',
        expectedResult: 'New user offers take priority over regular banners',
        uiState: 'Banner section is hidden, offers section shows',
        flutterFile: 'home_feed_view_page/viewmodel/home_feed_viewmodel.dart:1400',
      },
      {
        step: 3,
        action: 'User taps on new user offer',
        expectedResult: 'App navigates to restaurant or applies offer',
        uiState: 'Navigation occurs or offer is applied',
        flutterFile: 'home_feed_view_page/view/home_widgets/new_user_offer.dart',
      },
    ],
    postconditions: [
      'New user offers are displayed',
      'User can use offers',
      'Banners are hidden when offers exist',
    ],
    successCriteria: [
      'Offers display correctly',
      'Navigation works',
      'Offers are valid for new users only',
    ],
    relatedTestCases: ['TC-HOMEFEED-025'],
  },
];



